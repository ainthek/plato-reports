<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/selenium-webdriver/lib/webdriver/testing/jsunit.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/selenium-webdriver/lib/webdriver/testing/jsunit.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">57.50</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">340</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">45.08</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.11</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// Copyright 2011 Software Freedom Conservancy. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview File to include for turning any HTML file page into a WebDriver
 * JSUnit test suite by configuring an onload listener to the body that will
 * instantiate and start the test runner.
 */

goog.provide(&#039;webdriver.testing.jsunit&#039;);
goog.provide(&#039;webdriver.testing.jsunit.TestRunner&#039;);

goog.require(&#039;goog.testing.TestRunner&#039;);
goog.require(&#039;webdriver.testing.Client&#039;);
goog.require(&#039;webdriver.testing.TestCase&#039;);



/**
 * Constructs a test runner.
 * @param {!webdriver.testing.Client} client .
 * @constructor
 * @extends {goog.testing.TestRunner}
 */
webdriver.testing.jsunit.TestRunner = function(client) {
  goog.base(this);

  /** @private {!webdriver.testing.Client} */
  this.client_ = client;
};
goog.inherits(webdriver.testing.jsunit.TestRunner, goog.testing.TestRunner);


/**
 * Element created in the document to add test results to.
 * @private {Element}
 */
webdriver.testing.jsunit.TestRunner.prototype.logEl_ = null;


/**
 * DOM element used to stored screenshots. Screenshots are stored in the DOM to
 * avoid exhausting JS stack-space.
 * @private {Element}
 */
webdriver.testing.jsunit.TestRunner.prototype.screenshotCacheEl_ = null;


/** @override */
webdriver.testing.jsunit.TestRunner.prototype.initialize = function(testCase) {
  goog.base(this, &#039;initialize&#039;, testCase);
  this.screenshotCacheEl_ = document.createElement(&#039;div&#039;);
  document.body.appendChild(this.screenshotCacheEl_);
  this.screenshotCacheEl_.style.display = &#039;none&#039;;
};


/** @override */
webdriver.testing.jsunit.TestRunner.prototype.execute = function() {
  if (!this.testCase) {
    throw Error(&#039;The test runner must be initialized with a test case before &#039; +
                &#039;execute can be called.&#039;);
  }
  this.screenshotCacheEl_.innerHTML = &#039;&#039;;
  this.client_.sendInitEvent();
  this.testCase.setCompletedCallback(goog.bind(this.onComplete_, this));
  this.testCase.runTests();
};


/**
 * Writes a nicely formatted log out to the document. Overrides
 * {@link goog.testing.TestRunner#writeLog} to handle writing screenshots to the
 *     log.
 * @param {string} log The string to write.
 * @override
 */
webdriver.testing.jsunit.TestRunner.prototype.writeLog = function(log) {
  var lines = log.split(&#039;\n&#039;);
  for (var i = 0; i &lt; lines.length; i++) {
    var line = lines[i];
    var color;
    var isFailOrError = /FAILED/.test(line) || /ERROR/.test(line);
    var isScreenshot = / \[SCREENSHOT\] /.test(line);
    if (/PASSED/.test(line)) {
      color = &#039;darkgreen&#039;;
    } else if (isFailOrError) {
      color = &#039;darkred&#039;;
    } else if (isScreenshot) {
      color = &#039;darkblue&#039;;
    } else {
      color = &#039;#333&#039;;
    }

    var div = document.createElement(&#039;div&#039;);
    if (line.substr(0, 2) == &#039;&gt; &#039;) {
      // The stack trace may contain links so it has to be interpreted as HTML.
      div.innerHTML = line;
    } else {
      div.appendChild(document.createTextNode(line));
    }

    if (isFailOrError) {
      var testNameMatch = /(\S+) (\[[^\]]*] )?: (FAILED|ERROR)/.exec(line);
      if (testNameMatch) {
        // Build a URL to run the test individually.  If this test was already
        // part of another subset test, we need to overwrite the old runTests
        // query parameter.  We also need to do this without bringing in any
        // extra dependencies, otherwise we could mask missing dependency bugs.
        var newSearch = &#039;runTests=&#039; + testNameMatch[1];
        var search = window.location.search;
        if (search) {
          var oldTests = /runTests=([^&amp;]*)/.exec(search);
          if (oldTests) {
            newSearch = search.substr(0, oldTests.index) +
                        newSearch +
                        search.substr(oldTests.index + oldTests[0].length);
          } else {
            newSearch = search + &#039;&amp;&#039; + newSearch;
          }
        } else {
          newSearch = &#039;?&#039; + newSearch;
        }
        var href = window.location.href;
        var hash = window.location.hash;
        if (hash &amp;&amp; hash.charAt(0) != &#039;#&#039;) {
          hash = &#039;#&#039; + hash;
        }
        href = href.split(&#039;#&#039;)[0].split(&#039;?&#039;)[0] + newSearch + hash;

        // Add the link.
        var a = document.createElement(&#039;A&#039;);
        a.innerHTML = &#039;(run individually)&#039;;
        a.style.fontSize = &#039;0.8em&#039;;
        a.href = href;
        div.appendChild(document.createTextNode(&#039; &#039;));
        div.appendChild(a);
      }
    }

    if (isScreenshot &amp;&amp; this.screenshotCacheEl_.childNodes.length) {
      var nextScreenshot = this.screenshotCacheEl_.childNodes[0];
      this.screenshotCacheEl_.removeChild(nextScreenshot);

      a = document.createElement(&#039;A&#039;);
      a.style.fontSize = &#039;0.8em&#039;;
      a.href = &#039;javascript:void(0);&#039;;
      a.onclick = goog.partial(toggleVisibility, a, nextScreenshot);
      toggleVisibility(a, nextScreenshot);
      div.appendChild(document.createTextNode(&#039; &#039;));
      div.appendChild(a);
    }

    div.style.color = color;
    div.style.font = &#039;normal 100% monospace&#039;;

    try {
      div.style.whiteSpace = &#039;pre-wrap&#039;;
    } catch (e) {
      // NOTE(user): IE raises an exception when assigning to pre-wrap.
      // Thankfully, it doesn&#039;t collapse whitespace when using monospace fonts,
      // so it will display correctly if we ignore the exception.
    }

    if (i &lt; 2) {
      div.style.fontWeight = &#039;bold&#039;;
    }
    this.logEl_.appendChild(div);

    if (nextScreenshot) {
      a = document.createElement(&#039;A&#039;);
      // Accessing the |src| property in IE sometimes results in an
      // &quot;Invalid pointer&quot; error, which indicates it has been garbage
      // collected. This does not occur when using getAttribute.
      a.href = nextScreenshot.getAttribute(&#039;src&#039;);
      a.target = &#039;_blank&#039;;
      a.appendChild(nextScreenshot);
      this.logEl_.appendChild(a);
      nextScreenshot = null;
    }
  }

  function toggleVisibility(link, img) {
    if (img.style.display === &#039;none&#039;) {
      img.style.display = &#039;&#039;;
      link.innerHTML = &#039;(hide screenshot)&#039;;
    } else {
      img.style.display = &#039;none&#039;;
      link.innerHTML = &#039;(view screenshot)&#039;;
    }
  }
};


/**
 * Copied from goog.testing.TestRunner.prototype.onComplete_, which has private
 * visibility.
 * @private
 */
webdriver.testing.jsunit.TestRunner.prototype.onComplete_ = function() {
  var log = this.testCase.getReport(true);
  if (this.errors.length &gt; 0) {
    log += &#039;\n&#039; + this.errors.join(&#039;\n&#039;);
  }

  if (!this.logEl_) {
    this.logEl_ = document.createElement(&#039;div&#039;);
    document.body.appendChild(this.logEl_);
  }

  // Remove all children from the log element.
  var logEl = this.logEl_;
  while (logEl.firstChild) {
    logEl.removeChild(logEl.firstChild);
  }

  this.writeLog(log);
  this.client_.sendResultsEvent(this.isSuccess(), this.getReport(true));
};


/**
 * Takes a screenshot. In addition to saving the screenshot for viewing in the
 * HTML logs, the screenshot will also be saved using
 * @param {!webdriver.WebDriver} driver The driver to take the screenshot with.
 * @param {string=} opt_label An optional debug label to identify the screenshot
 *     with.
 * @return {!webdriver.promise.Promise} A promise that will be resolved to the
 *     screenshot as a base-64 encoded PNG.
 */
webdriver.testing.jsunit.TestRunner.prototype.takeScreenshot = function(
    driver, opt_label) {
  if (!this.isInitialized()) {
    throw Error(
        &#039;The test runner must be initialized before it may be used to&#039; +
        &#039; take screenshots&#039;);
  }

  var client = this.client_;
  var testCase = this.testCase;
  var screenshotCache = this.screenshotCacheEl_;
  return driver.takeScreenshot().then(function(png) {
    client.sendScreenshotEvent(png, opt_label);

    var img = document.createElement(&#039;img&#039;);
    img.src = &#039;data:image/png;base64,&#039; + png;
    img.style.border = &#039;1px solid black&#039;;
    img.style.maxWidth = &#039;500px&#039;;
    screenshotCache.appendChild(img);

    if (testCase) {
      testCase.saveMessage(&#039;[SCREENSHOT] &#039; + (opt_label || &#039;&lt;Not Labeled&gt;&#039;));
    }
    return png;
  });
};


/**
 * Sends a base64 encoded PNG image to the server to be saved in the test
 * outputs.
 * @param {string} data The base64 encoded PNG image to be sent to the server.
 * @param {string=} opt_label An optional debug label to identify the
 *     screenshot with.
 */
webdriver.testing.jsunit.TestRunner.prototype.saveImage = function(
    data, opt_label) {
  if (!this.isInitialized()) {
    throw Error(
        &#039;The test runner must be initialized before it may be used to&#039; +
        &#039; save images&#039;);
  }

  this.client_.sendScreenshotEvent(data, opt_label);

  var img = document.createElement(&#039;img&#039;);
  img.src = &#039;data:image/png;base64,&#039; + data;
  img.style.border = &#039;1px solid black&#039;;
  img.style.maxWidth = &#039;500px&#039;;
  this.screenshotCacheEl_.appendChild(img);

  if (this.testCase) {
    this.testCase.saveMessage(&#039;[SCREENSHOT] &#039; + (opt_label || &#039;&lt;Not Labeled&gt;&#039;));
  }
};


(function() {
  var client = new webdriver.testing.Client();
  var tr = new webdriver.testing.jsunit.TestRunner(client);

  // Export our test runner so it can be accessed by Selenium/WebDriver. This
  // will only work if webdriver.WebDriver is using a pure-JavaScript
  // webdriver.CommandExecutor. Otherwise, the JS-client could change the
  // driver&#039;s focus to another window or frame and the Java/Python-client
  // wouldn&#039;t be able to access this object.
  goog.exportSymbol(&#039;G_testRunner&#039;, tr);
  goog.exportSymbol(&#039;G_testRunner.initialize&#039;, tr.initialize);
  goog.exportSymbol(&#039;G_testRunner.isInitialized&#039;, tr.isInitialized);
  goog.exportSymbol(&#039;G_testRunner.isFinished&#039;, tr.isFinished);
  goog.exportSymbol(&#039;G_testRunner.isSuccess&#039;, tr.isSuccess);
  goog.exportSymbol(&#039;G_testRunner.getReport&#039;, tr.getReport);
  goog.exportSymbol(&#039;G_testRunner.getRunTime&#039;, tr.getRunTime);
  goog.exportSymbol(&#039;G_testRunner.getNumFilesLoaded&#039;, tr.getNumFilesLoaded);
  goog.exportSymbol(&#039;G_testRunner.setStrict&#039;, tr.setStrict);
  goog.exportSymbol(&#039;G_testRunner.logTestFailure&#039;, tr.logTestFailure);

  // Export debug as a global function for JSUnit compatibility.  This just
  // calls log on the current test case.
  if (!goog.global[&#039;debug&#039;]) {
    goog.exportSymbol(&#039;debug&#039;, goog.bind(tr.log, tr));
  }

  // Add an error handler to report errors that may occur during
  // initialization of the page.
  var onerror = window.onerror;
  window.onerror = function(error, url, line) {
    // Call any existing onerror handlers.
    if (onerror) {
      onerror(error, url, line);
    }
    if (typeof error == &#039;object&#039;) {
      // Webkit started passing an event object as the only argument to
      // window.onerror.  It doesn&#039;t contain an error message, url or line
      // number.  We therefore log as much info as we can.
      if (error.target &amp;&amp; error.target.tagName == &#039;SCRIPT&#039;) {
        tr.logError(&#039;UNKNOWN ERROR: Script &#039; + error.target.src);
      } else {
        tr.logError(&#039;UNKNOWN ERROR: No error information available.&#039;);
      }
    } else {
      tr.logError(&#039;JS ERROR: &#039; + error + &#039;\nURL: &#039; + url + &#039;\nLine: &#039; + line);
    }
  };

  var onload = window.onload;
  window.onload = function() {
    // Call any existing onload handlers.
    if (onload) {
      onload();
    }

    var testCase = new webdriver.testing.TestCase(client, document.title);
    testCase.autoDiscoverTests();

    tr.initialize(testCase);
    tr.execute();
  };
})();</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
