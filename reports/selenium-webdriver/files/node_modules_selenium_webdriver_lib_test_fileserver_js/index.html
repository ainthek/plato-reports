<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/selenium-webdriver/lib/test/fileserver.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/selenium-webdriver/lib/test/fileserver.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">62.14</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">454</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">37.36</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.12</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// Copyright 2013 Selenium committers
// Copyright 2013 Software Freedom Conservancy
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
//     You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

&#039;use strict&#039;;

var fs = require(&#039;fs&#039;),
    http = require(&#039;http&#039;),
    path = require(&#039;path&#039;),
    url = require(&#039;url&#039;);

var Server = require(&#039;./httpserver&#039;).Server,
    resources = require(&#039;./resources&#039;),
    promise = require(&#039;../..&#039;).promise,
    isDevMode = require(&#039;../../_base&#039;).isDevMode(),
    string = require(&#039;../../_base&#039;).require(&#039;goog.string&#039;);

var WEB_ROOT = isDevMode ? &#039;/common/src/web&#039; : &#039;/common&#039;;
var JS_ROOT = &#039;/javascript&#039;;

var baseDirectory = resources.locate(&#039;.&#039;),
    server = new Server(onRequest);


var Pages = (function() {
  var pages = {};
  function addPage(page, path) {
    pages.__defineGetter__(page, function() {
      return exports.whereIs(path);
    });
  }

  addPage(&#039;ajaxyPage&#039;, &#039;ajaxy_page.html&#039;);
  addPage(&#039;alertsPage&#039;, &#039;alerts.html&#039;);
  addPage(&#039;bodyTypingPage&#039;, &#039;bodyTypingTest.html&#039;);
  addPage(&#039;booleanAttributes&#039;, &#039;booleanAttributes.html&#039;);
  addPage(&#039;childPage&#039;, &#039;child/childPage.html&#039;);
  addPage(&#039;chinesePage&#039;, &#039;cn-test.html&#039;);
  addPage(&#039;clickJacker&#039;, &#039;click_jacker.html&#039;);
  addPage(&#039;clickEventPage&#039;, &#039;clickEventPage.html&#039;);
  addPage(&#039;clicksPage&#039;, &#039;clicks.html&#039;);
  addPage(&#039;colorPage&#039;, &#039;colorPage.html&#039;);
  addPage(&#039;deletingFrame&#039;, &#039;deletingFrame.htm&#039;);
  addPage(&#039;draggableLists&#039;, &#039;draggableLists.html&#039;);
  addPage(&#039;dragAndDropPage&#039;, &#039;dragAndDropTest.html&#039;);
  addPage(&#039;droppableItems&#039;, &#039;droppableItems.html&#039;);
  addPage(&#039;documentWrite&#039;, &#039;document_write_in_onload.html&#039;);
  addPage(&#039;dynamicallyModifiedPage&#039;, &#039;dynamicallyModifiedPage.html&#039;);
  addPage(&#039;dynamicPage&#039;, &#039;dynamic.html&#039;);
  addPage(&#039;errorsPage&#039;, &#039;errors.html&#039;);
  addPage(&#039;xhtmlFormPage&#039;, &#039;xhtmlFormPage.xhtml&#039;);
  addPage(&#039;formPage&#039;, &#039;formPage.html&#039;);
  addPage(&#039;formSelectionPage&#039;, &#039;formSelectionPage.html&#039;);
  addPage(&#039;framesetPage&#039;, &#039;frameset.html&#039;);
  addPage(&#039;grandchildPage&#039;, &#039;child/grandchild/grandchildPage.html&#039;);
  addPage(&#039;html5Page&#039;, &#039;html5Page.html&#039;);
  addPage(&#039;html5OfflinePage&#039;, &#039;html5/offline.html&#039;);
  addPage(&#039;iframePage&#039;, &#039;iframes.html&#039;);
  addPage(&#039;javascriptEnhancedForm&#039;, &#039;javascriptEnhancedForm.html&#039;);
  addPage(&#039;javascriptPage&#039;, &#039;javascriptPage.html&#039;);
  addPage(&#039;linkedImage&#039;, &#039;linked_image.html&#039;);
  addPage(&#039;longContentPage&#039;, &#039;longContentPage.html&#039;);
  addPage(&#039;macbethPage&#039;, &#039;macbeth.html&#039;);
  addPage(&#039;mapVisibilityPage&#039;, &#039;map_visibility.html&#039;);
  addPage(&#039;metaRedirectPage&#039;, &#039;meta-redirect.html&#039;);
  addPage(&#039;missedJsReferencePage&#039;, &#039;missedJsReference.html&#039;);
  addPage(&#039;mouseTrackerPage&#039;, &#039;mousePositionTracker.html&#039;);
  addPage(&#039;nestedPage&#039;, &#039;nestedElements.html&#039;);
  addPage(&#039;readOnlyPage&#039;, &#039;readOnlyPage.html&#039;);
  addPage(&#039;rectanglesPage&#039;, &#039;rectangles.html&#039;);
  addPage(&#039;redirectPage&#039;, &#039;redirect&#039;);
  addPage(&#039;resultPage&#039;, &#039;resultPage.html&#039;);
  addPage(&#039;richTextPage&#039;, &#039;rich_text.html&#039;);
  addPage(&#039;selectableItemsPage&#039;, &#039;selectableItems.html&#039;);
  addPage(&#039;selectPage&#039;, &#039;selectPage.html&#039;);
  addPage(&#039;simpleTestPage&#039;, &#039;simpleTest.html&#039;);
  addPage(&#039;simpleXmlDocument&#039;, &#039;simple.xml&#039;);
  addPage(&#039;sleepingPage&#039;, &#039;sleep&#039;);
  addPage(&#039;slowIframes&#039;, &#039;slow_loading_iframes.html&#039;);
  addPage(&#039;slowLoadingAlertPage&#039;, &#039;slowLoadingAlert.html&#039;);
  addPage(&#039;svgPage&#039;, &#039;svgPiechart.xhtml&#039;);
  addPage(&#039;tables&#039;, &#039;tables.html&#039;);
  addPage(&#039;underscorePage&#039;, &#039;underscore.html&#039;);
  addPage(&#039;unicodeLtrPage&#039;, &#039;utf8/unicode_ltr.html&#039;);
  addPage(&#039;uploadPage&#039;, &#039;upload.html&#039;);
  addPage(&#039;veryLargeCanvas&#039;, &#039;veryLargeCanvas.html&#039;);
  addPage(&#039;xhtmlTestPage&#039;, &#039;xhtmlTest.html&#039;);

  return pages;
})();


var Path = {
  BASIC_AUTH: WEB_ROOT + &#039;/basicAuth&#039;,
  MANIFEST: WEB_ROOT + &#039;/manifest&#039;,
  REDIRECT: WEB_ROOT + &#039;/redirect&#039;,
  PAGE: WEB_ROOT + &#039;/page&#039;,
  SLEEP: WEB_ROOT + &#039;/sleep&#039;,
  UPLOAD: WEB_ROOT + &#039;/upload&#039;
};


/**
 * HTTP request handler.
 * @param {!http.ServerRequest} request The request object.
 * @param {!http.ServerResponse} response The response object.
 */
function onRequest(request, response) {
  if (request.method !== &#039;GET&#039; &amp;&amp; request.method !== &#039;HEAD&#039;) {
    response.writeHead(405, {&#039;Allowed&#039;: &#039;GET,HEAD&#039;});
    return response.end();
  }

  var pathname = path.resolve(url.parse(request.url).pathname);
  if (pathname === &#039;/&#039;) {
    return sendIndex(request, response);
  }

  if (pathname === &#039;/favicon.ico&#039;) {
    response.writeHead(204);
    return response.end();
  }

  switch (pathname) {
    case Path.BASIC_AUTH: return sendBasicAuth(response);
    case Path.MANIFEST: return sendManifest(response);
    case Path.PAGE: return sendInifinitePage(request, response);
    case Path.REDIRECT: return redirectToResultPage(response);
    case Path.SLEEP: return sendDelayedResponse(request, response);
    case Path.UPLOAD: return sendUpload(response);
  }

  if (string.startsWith(pathname, Path.PAGE + &#039;/&#039;)) {
    return sendInifinitePage(request, response);
  }

  if ((string.startsWith(pathname, WEB_ROOT) ||
       string.startsWith(pathname, JS_ROOT)) &amp;&amp;
      string.endsWith(pathname, &#039;.appcache&#039;)) {
    return sendManifest(response);
  }

  if (string.startsWith(pathname, WEB_ROOT)) {
    if (!isDevMode) {
      pathname = pathname.substring(WEB_ROOT.length);
    }
  } else if (string.startsWith(pathname, JS_ROOT)) {
    if (!isDevMode) {
      sendSimpleError(response, 404, request.url);
      return;
    }
    pathname = pathname.substring(JS_ROOT);
  }

  try {
    var fullPath = resources.locate(pathname);
  } catch (ex) {
    fullPath = &#039;&#039;;
  }

  if (fullPath.lastIndexOf(baseDirectory, 0) == -1) {
    sendSimpleError(response, 404, request.url);
    return;
  }

  fs.stat(fullPath, function(err, stats) {
    if (err) {
      sendIOError(request, response, err);
    } else if (stats.isDirectory()) {
      sendDirectoryListing(request, response, fullPath);
    } else if (stats.isFile()) {
      sendFile(request, response, fullPath);
    } else {
      sendSimpleError(response, 404, request.url);
    }
  });
}


function redirectToResultPage(response) {
  response.writeHead(303, {
    Location: Pages.resultPage
  });
  return response.end();
}


function sendInifinitePage(request, response) {
  setTimeout(function() {
    var pathname = url.parse(request.url).pathname;
    var lastIndex = pathname.lastIndexOf(&#039;/&#039;);
    var pageNumber =
        (lastIndex == -1 ? &#039;Unknown&#039; : pathname.substring(lastIndex + 1));
    var body = [
      &#039;&lt;!DOCTYPE html&gt;&#039;,
      &#039;&lt;title&gt;Page&#039;, pageNumber, &#039;&lt;/title&gt;&#039;,
      &#039;Page number &lt;span id=&quot;pageNumber&quot;&gt;&#039;, pageNumber, &#039;&lt;/span&gt;&#039;,
      &#039;&lt;p&gt;&lt;a href=&quot;../xhtmlTest.html&quot; target=&quot;_top&quot;&gt;top&lt;/a&gt;&#039;
    ].join(&#039;&#039;);
    response.writeHead(200, {
      &#039;Content-Length&#039;: Buffer.byteLength(body, &#039;utf8&#039;),
      &#039;Content-Type&#039;: &#039;text/html; charset=utf-8&#039;
    });
    response.end(body);
  }, 500);
}


function sendDelayedResponse(request, response) {
  var duration = 0;
  var query = url.parse(request.url).query || &#039;&#039;;
  var match = query.match(/\btime=(\d+)/);
  if (match) {
    duration = parseInt(match[1]);
  }

  setTimeout(function() {
    var body = [
      &#039;&lt;!DOCTYPE html&gt;&#039;,
      &#039;&lt;title&gt;Done&lt;/title&gt;&#039;,
      &#039;&lt;body&gt;Slept for &#039;, duration, &#039;s&lt;/body&gt;&#039;
    ].join(&#039;&#039;);
    response.writeHead(200, {
      &#039;Content-Length&#039;: Buffer.byteLength(body, &#039;utf8&#039;),
      &#039;Content-Type&#039;: &#039;text/html; charset=utf-8&#039;,
      &#039;Cache-Control&#039;: &#039;no-cache&#039;,
      &#039;Pragma&#039;: &#039;no-cache&#039;,
      &#039;Expires&#039;: 0
    });
    response.end(body);
  }, duration * 1000);
}


/**
 * Sends an error in response to an I/O operation.
 * @param {!http.ServerRequest} request The request object.
 * @param {!http.ServerResponse} response The response object.
 * @param {!Error} err The I/O error.
 */
function sendIOError(request, response, err) {
  var code = 500;
  if (err.code === &#039;ENOENT&#039;) {
    code = 404;
  } else if (err.code === &#039;EACCES&#039;) {
    code = 403;
  }
  sendSimpleError(response, code, request.url);
}


/**
 * Sends a simple error message to the client and instructs it to close the
 * connection.
 * @param {!http.ServerResponse} response The response to populate.
 * @param {number} code The numeric HTTP code to send.
 * @param {string} message The error message.
 */
function sendSimpleError(response, code, message) {
  response.writeHead(code, {
    &#039;Content-Type&#039;: &#039;text/html; charset=utf-8&#039;,
    &#039;Connection&#039;: &#039;close&#039;
  });
  response.end(
      &#039;&lt;!DOCTYPE html&gt;&lt;h1&gt;&#039; + code + &#039; &#039; + http.STATUS_CODES[code] +
      &#039;&lt;/h1&gt;&lt;hr/&gt;&#039; + message);
}


var MimeType = {
  &#039;css&#039;: &#039;text/css&#039;,
  &#039;gif&#039;: &#039;image/gif&#039;,
  &#039;html&#039;: &#039;text/html&#039;,
  &#039;js&#039;: &#039;application/javascript&#039;,
  &#039;png&#039;: &#039;image/png&#039;,
  &#039;svg&#039;: &#039;image/svg+xml&#039;,
  &#039;txt&#039;: &#039;text/plain&#039;,
  &#039;xhtml&#039;: &#039;application/xhtml+xml&#039;,
  &#039;xsl&#039;: &#039;application/xml&#039;,
  &#039;xml&#039;: &#039;application/xml&#039;
};


/**
 * Responds to a request for an individual file.
 * @param {!http.ServerRequest} request The request object.
 * @param {!http.ServerResponse} response The response object.
 * @param {string} filePath Path to the file to return.
 */
function sendFile(request, response, filePath) {
  fs.readFile(filePath, function(err, buffer) {
    if (err) {
      sendIOError(request, response, err);
      return;
    }
    var index = filePath.lastIndexOf(&#039;.&#039;);
    var type = MimeType[index &lt; 0 ? &#039;&#039; : filePath.substring(index + 1)];
    var headers = {&#039;Content-Length&#039;: buffer.length};
    if (type) headers[&#039;Content-Type&#039;] = type;
    response.writeHead(200, headers);
    response.end(buffer);
  });
}


/**
 * Responds to a request for the file server&#039;s main index.
 * @param {!http.ServerRequest} request The request object.
 * @param {!http.ServerResponse} response The response object.
 */
function sendIndex(request, response) {
  var pathname = url.parse(request.url).pathname;

  var host = request.headers.host;
  if (!host) {
    host = server.host();
  }

  var requestUrl = [&#039;http://&#039; + host + pathname].join(&#039;&#039;);

  function createListEntry(path) {
    var url = requestUrl + path;
    return [&#039;&lt;li&gt;&lt;a href=&quot;&#039;, url, &#039;&quot;&gt;&#039;, path, &#039;&lt;/a&gt;&#039;].join(&#039;&#039;);
  }

  var data = [&#039;&lt;!DOCTYPE html&gt;&lt;h1&gt;/&lt;/h1&gt;&lt;hr/&gt;&lt;ul&gt;&#039;,
              createListEntry(&#039;common&#039;)];
  if (isDevMode) {
    data.push(createListEntry(&#039;javascript&#039;));
  }
  data.push(&#039;&lt;/ul&gt;&#039;);
  data = data.join(&#039;&#039;);

  response.writeHead(200, {
    &#039;Content-Type&#039;: &#039;text/html; charset=UTF-8&#039;,
    &#039;Content-Length&#039;: Buffer.byteLength(data, &#039;utf8&#039;)
  });
  response.end(data);
}


/**
 * Responds to a request for a directory listing.
 * @param {!http.ServerRequest} request The request object.
 * @param {!http.ServerResponse} response The response object.
 * @param {string} dirPath Path to the directory to generate a listing for.
 */
function sendDirectoryListing(request, response, dirPath) {
  var pathname = url.parse(request.url).pathname;

  var host = request.headers.host;
  if (!host) {
    host = server.host();
  }

  var requestUrl = [&#039;http://&#039; + host + pathname].join(&#039;&#039;);
  if (requestUrl[requestUrl.length - 1] !== &#039;/&#039;) {
    response.writeHead(303, {&#039;Location&#039;: requestUrl + &#039;/&#039;});
    return response.end();
  }

  fs.readdir(dirPath, function(err, files) {
    if (err) {
      sendIOError(request, response, err);
      return;
    }

    var data = [&#039;&lt;!DOCTYPE html&gt;&lt;h1&gt;&#039;, pathname, &#039;&lt;/h1&gt;&lt;hr/&gt;&lt;ul&gt;&#039;];
    if (pathname !== &#039;/&#039;) {
      data.push(createListEntry(&#039;../&#039;));
    }
    processNextFile();

    function processNextFile() {
      var file = files.shift();
      if (file) {
        fs.stat(path.join(dirPath, file), function(err, stats) {
          if (err) {
            sendIOError(request, response, err);
            return;
          }

          data.push(createListEntry(
              stats.isDirectory() ? file + &#039;/&#039; : file));
          processNextFile();
        });
      } else {
        data = new Buffer(data.join(&#039;&#039;), &#039;utf-8&#039;);
        response.writeHead(200, {
          &#039;Content-Type&#039;: &#039;text/html; charset=utf-8&#039;,
          &#039;Content-Length&#039;: data.length
        });
        response.end(data);
      }
    }

    function createListEntry(path) {
      var url = requestUrl + path;
      return [&#039;&lt;li&gt;&lt;a href=&quot;&#039;, url, &#039;&quot;&gt;&#039;, path, &#039;&lt;/a&gt;&#039;].join(&#039;&#039;);
    }
  });
}


// PUBLIC application


/**
 * Starts the server on the specified port.
 * @param {number=} opt_port The port to use, or 0 for any free port.
 * @return {!webdriver.promise.Promise.&lt;Host&gt;} A promise that will resolve
 *     with the server host when it has fully started.
 */
exports.start = server.start.bind(server);


/**
 * Stops the server.
 * @return {!webdriver.promise.Promise} A promise that will resolve when the
 *     server has closed all connections.
 */
exports.stop = server.stop.bind(server);


/**
 * Formats a URL for this server.
 * @param {string=} opt_pathname The desired pathname on the server.
 * @return {string} The formatted URL.
 * @throws {Error} If the server is not running.
 */
exports.url = server.url.bind(server);


/**
 * Builds the URL for a file in the //common/src/web directory of the
 * Selenium client.
 * @param {string} filePath A path relative to //common/src/web to compute a
 *     URL for.
 * @return {string} The formatted URL.
 * @throws {Error} If the server is not running.
 */
exports.whereIs = function(filePath) {
  filePath = filePath.replace(/\\/g, &#039;/&#039;);
  if (!string.startsWith(filePath, &#039;/&#039;)) {
    filePath = &#039;/&#039; + filePath;
  }
  return server.url(WEB_ROOT + filePath);
};


exports.Pages = Pages;


if (require.main === module) {
  server.start(2310).then(function() {
    console.log(&#039;Server running at &#039; + server.url());
  });
}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
