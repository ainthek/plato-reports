<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/wire/builder/cram.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/wire/builder/cram.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">73.94</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">242</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">36.27</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.71</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/** @license MIT License (c) copyright B Cavalier &amp; J Hann */

/**
 * wire/cram/builder plugin
 * Builder plugin for cram
 * https://github.com/cujojs/cram
 *
 * wire is part of the cujoJS family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(define) {
define(function(require) {

	var when, unfold, mid, defaultModuleRegex, defaultSpecRegex, replaceIdsRegex,
		removeCommentsRx, splitIdsRegex;

	when = require(&#039;when&#039;);
	unfold = require(&#039;when/unfold&#039;);
	mid = require(&#039;../lib/loader/moduleId&#039;);

	// default dependency regex
	defaultModuleRegex = /\.(module|create)$/;
	defaultSpecRegex = /\.(wire\.spec|wire)$/;
	// adapted from cram&#039;s scan function:
	//replaceIdsRegex = /(define)\s*\(\s*(?:\s*[&quot;&#039;]([^&quot;&#039;]*)[&quot;&#039;]\s*,)?(?:\s*\[([^\]]+)\]\s*,)?\s*(function)?\s*(?:\(([^)]*)\))?/g;
	//replaceIdsRegex = /(define)\s*\(\s*(?:\s*[&quot;&#039;]([^&quot;&#039;]*)[&quot;&#039;]\s*,)?(?:\s*\[([^\]]*)\]\s*,)?/;
	replaceIdsRegex = /(\bdefine)\s*\(\s*(?:\s*&#039;([^&#039;]*)&#039;|&quot;([^&quot;]*)&quot;\s*,)?(?:\s*\[([^\]]*)\]\s*,)?/;
	removeCommentsRx = /\/\*[\s\S]*?\*\//g;
	splitIdsRegex = /\s*,\s*/;

	return {
		normalize: normalize,
		compile: compile
	};

	function normalize(resourceId, toAbsId) {
		return resourceId ? toAbsId(resourceId.split(&quot;!&quot;)[0]) : resourceId;
	}

	function compile(wireId, resourceId, require, io, config) {
		// Track all modules seen in wire spec, so we only include them once
		var specIds, defines, seenModules, childSpecRegex,
			moduleRegex;

		defines = [];
		seenModules = {};
		moduleRegex = defaultModuleRegex;
		childSpecRegex = defaultSpecRegex;

		// Get config values
		if(config) {
			if(config.moduleRegex) moduleRegex = new RegExp(config.moduleRegex);
			if(config.childSpecRegex) childSpecRegex = new RegExp(config.childSpecRegex);
		}

		// Grab the spec module id, *or comma separated list of spec module ids*
		// Split in case it&#039;s a comma separated list of spec ids
		specIds = resourceId.split(splitIdsRegex);

		return when.map(specIds, function(specId) {
			return processSpec(specId);
		}).then(write, io.error);

		// For each spec id, add the spec itself as a dependency, and then
		// scan the spec contents to find all modules that it needs (e.g.
		// &quot;module&quot; and &quot;create&quot;)
		function processSpec(specId) {
			var dependencies, ids;

			dependencies = [];
			ids = [specId];

			_addDep(wireId);

			return unfold(fetchNextSpec, endOfList, scanSpec, ids)
				.then(function() {
					return generateDefine(specId, dependencies);
				}
			);

			function fetchNextSpec() {
				var id = ids.shift();
				return when.promise(function(resolve, reject) {
					require(
						[id],
						function(spec) { resolve([{ spec: spec, id: id }, ids]); },
						reject
					);
				});
			}

			function _addDep(moduleId) {
				if(!(moduleId in seenModules)) {
					dependencies.push(moduleId);
					seenModules[moduleId] = moduleId;
				}
			}

			function scanSpec(specDescriptor) {
				var spec = specDescriptor.spec;

				scanPlugins(spec);
				scanObj(spec);

				function resolveId(moduleId) {
					return mid.resolve(specDescriptor.id, moduleId)
				}

				function scanObj(obj, path) {
					// Scan all keys.  This might be the spec itself,
					// or any sub-object-literal in the spec.
					for (var name in obj) {
						scanItem(obj[name], createPath(path, name));
					}
				}

				function scanItem(it, path) {
					// Determine the kind of thing we&#039;re looking at
					// 1. If it&#039;s a string, and the key is module or create, then assume it
					//    is a moduleId, and add it as a dependency.
					// 2. If it&#039;s an object or an array, scan it recursively
					// 3. If it&#039;s a wire spec, add it to the list of spec ids
					if (isSpec(path) &amp;&amp; typeof it === &#039;string&#039;) {
						addSpec(it);

					} else if (isDep(path) &amp;&amp; typeof it === &#039;string&#039;) {
						// Get module def
						addDep(it);

					} else if (isStrictlyObject(it)) {
						// Descend into subscope
						scanObj(it, path);

					} else if (Array.isArray(it)) {
						// Descend into array
						var arrayPath = path + &#039;[]&#039;;
						it.forEach(function(arrayItem) {
							scanItem(arrayItem, arrayPath);
						});
					}
				}

				function scanPlugins(spec) {
					var plugins = spec.$plugins || spec.plugins;

					if(Array.isArray(plugins)) {
						plugins.forEach(addPlugin);
					} else if(typeof plugins === &#039;object&#039;) {
						Object.keys(plugins).forEach(function(key) {
							addPlugin(plugins[key]);
						});
					}
				}

				function addPlugin(plugin) {
					if(typeof plugin === &#039;string&#039;) {
						addDep(plugin);
					} else if(typeof plugin === &#039;object&#039; &amp;&amp; plugin.module) {
						addDep(plugin.module);
					}
				}

				function addDep(moduleId) {
					_addDep(resolveId(moduleId));
				}

				function addSpec(specId) {
					specId = resolveId(specId);
					if(!(specId in seenModules)) {
						ids.push(specId);
					}
					_addDep(specId);
				}

			}

		}

		function generateDefine(specId, dependencies) {
			var dfd, buffer;

			dfd = when.defer();

			io.read(ensureExtension(specId, &#039;js&#039;), function(specText) {
				buffer = injectIds(specText, specId, dependencies);

				defines.push(buffer);
				dfd.resolve();

			}, dfd.reject);

			return dfd.promise;
		}

		function write() {
			// protect against prior code that may have omitted a semi-colon
			io.write(&#039;\n;&#039; + defines.join(&#039;\n&#039;));
		}

		function isDep(path) {
			return moduleRegex.test(path);
		}

		function isSpec(path) {
			return childSpecRegex.test(path);
		}
	}

	function createPath(path, name) {
		return path ? (path + &#039;.&#039; + name) : name
	}

	function isStrictlyObject(it) {
		return (it &amp;&amp; Object.prototype.toString.call(it) == &#039;[object Object]&#039;);
	}

	function ensureExtension(id, ext) {
		return id.lastIndexOf(&#039;.&#039;) &lt;= id.lastIndexOf(&#039;/&#039;)
			? id + &#039;.&#039; + ext
			: id;
	}

	function injectIds(moduleText, absId, moduleIds) {
		var replaced, newText;
		// note: replaceIdsRegex removes commas, parens, and brackets
		newText = moduleText.replace(removeCommentsRx, &#039;&#039;).replace(replaceIdsRegex, function (m, def, mid1, mid2, depIds) {
			replaced = true;
			// merge deps, but not args since they&#039;re not referenced in module
			if(depIds) {
				moduleIds = depIds.split(splitIdsRegex).concat(moduleIds);
			}

			moduleIds = &#039;[&#039; + moduleIds.map(quoted).join(&#039;, &#039;) + &#039;], &#039;;

			return def + &#039;(&#039; + quoted(absId) + &#039;, &#039; + moduleIds;
		});
		if (!replaced) {
			throw new Error(&#039;Unable to parse AMD define() in &#039; + absId);
		}
		return newText;
	}

	function quoted(id) {
		return &#039;&quot;&#039; + id + &#039;&quot;&#039;;
	}

	function endOfList(ids) {
		return !ids.length;
	}

});
}(typeof define === &#039;function&#039; &amp;&amp; define.amd ? define : function(factory) { module.exports = factory(require); }));</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
