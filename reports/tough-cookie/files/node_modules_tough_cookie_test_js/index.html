<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/tough-cookie/test.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/tough-cookie/test.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">82.29</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">1605</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">92.05</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">24.95</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/*
 * Copyright GoInstant, Inc. and other contributors. All rights reserved.
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */
&#039;use strict&#039;;
var vows = require(&#039;vows&#039;);
var assert = require(&#039;assert&#039;);
var async = require(&#039;async&#039;);

// NOTE use require(&quot;tough-cookie&quot;) in your own code:
var tough = require(&#039;./lib/cookie&#039;);
var Cookie = tough.Cookie;
var CookieJar = tough.CookieJar;


function dateVows(table) {
  var theVows = { };
  Object.keys(table).forEach(function(date) {
    var expect = table[date];
    theVows[date] = function() {
      var got = tough.parseDate(date) ? &#039;valid&#039; : &#039;invalid&#039;;
      assert.equal(got, expect ? &#039;valid&#039; : &#039;invalid&#039;);
    };
  });
  return { &quot;date parsing&quot;: theVows };
}

function matchVows(func,table) {
  var theVows = {};
  table.forEach(function(item) {
    var str = item[0];
    var dom = item[1];
    var expect = item[2];
    var label = str+(expect?&quot; matches &quot;:&quot; doesn&#039;t match &quot;)+dom;
    theVows[label] = function() {
      assert.equal(func(str,dom),expect);
    };
  });
  return theVows;
}

function defaultPathVows(table) {
  var theVows = {};
  table.forEach(function(item) {
    var str = item[0];
    var expect = item[1];
    var label = str+&quot; gives &quot;+expect;
    theVows[label] = function() {
      assert.equal(tough.defaultPath(str),expect);
    };
  });
  return theVows;
}

var atNow = Date.now();
function at(offset) { return {now: new Date(atNow+offset)}; }

vows.describe(&#039;Cookie Jar&#039;)
.addBatch({
  &quot;all defined&quot;: function() {
    assert.ok(Cookie);
    assert.ok(CookieJar);
  },
})
.addBatch(
  dateVows({
    &quot;Wed, 09 Jun 2021 10:18:14 GMT&quot;: true,
    &quot;Wed, 09 Jun 2021 22:18:14 GMT&quot;: true,
    &quot;Tue, 18 Oct 2011 07:42:42.123 GMT&quot;: true,
    &quot;18 Oct 2011 07:42:42 GMT&quot;: true,
    &quot;8 Oct 2011 7:42:42 GMT&quot;: true,
    &quot;8 Oct 2011 7:2:42 GMT&quot;: false,
    &quot;Oct 18 2011 07:42:42 GMT&quot;: true,
    &quot;Tue Oct 18 2011 07:05:03 GMT+0000 (GMT)&quot;: true,
    &quot;09 Jun 2021 10:18:14 GMT&quot;: true,
    &quot;99 Jix 3038 48:86:72 ZMT&quot;: false,
    &#039;01 Jan 1970 00:00:00 GMT&#039;: true,
    &#039;01 Jan 1600 00:00:00 GMT&#039;: false, // before 1601
    &#039;01 Jan 1601 00:00:00 GMT&#039;: true,
    &#039;10 Feb 81 13:00:00 GMT&#039;: true, // implicit year
    &#039;Thu, 01 Jan 1970 00:00:010 GMT&#039;: true, // strange time, non-strict OK
    &#039;Thu, 17-Apr-2014 02:12:29 GMT&#039;: true, // dashes
    &#039;Thu, 17-Apr-2014 02:12:29 UTC&#039;: true, // dashes and UTC
  })
)
.addBatch({
  &quot;strict date parse of Thu, 01 Jan 1970 00:00:010 GMT&quot;: {
    topic: function() {
      return tough.parseDate(&#039;Thu, 01 Jan 1970 00:00:010 GMT&#039;, true) ? true : false;
    },
    &quot;invalid&quot;: function(date) {
      assert.equal(date,false);
    },
  }
})
.addBatch({
  &quot;formatting&quot;: {
    &quot;a simple cookie&quot;: {
      topic: function() {
        var c = new Cookie();
        c.key = &#039;a&#039;;
        c.value = &#039;b&#039;;
        return c;
      },
      &quot;validates&quot;: function(c) {
        assert.ok(c.validate());
      },
      &quot;to string&quot;: function(c) {
        assert.equal(c.toString(), &#039;a=b&#039;);
      },
    },
    &quot;a cookie with spaces in the value&quot;: {
      topic: function() {
        var c = new Cookie();
        c.key = &#039;a&#039;;
        c.value = &#039;beta gamma&#039;;
        return c;
      },
      &quot;doesn&#039;t validate&quot;: function(c) {
        assert.ok(!c.validate());
      },
      &quot;&#039;garbage in, garbage out&#039;&quot;: function(c) {
        assert.equal(c.toString(), &#039;a=beta gamma&#039;);
      },
    },
    &quot;with an empty value and HttpOnly&quot;: {
      topic: function() {
        var c = new Cookie();
        c.key = &#039;a&#039;;
        c.httpOnly = true;
        return c;
      },
      &quot;to string&quot;: function(c) {
        assert.equal(c.toString(), &#039;a=; HttpOnly&#039;);
      }
    },
    &quot;with an expiry&quot;: {
      topic: function() {
        var c = new Cookie();
        c.key = &#039;a&#039;;
        c.value = &#039;b&#039;;
        c.setExpires(&quot;Oct 18 2011 07:05:03 GMT&quot;);
        return c;
      },
      &quot;validates&quot;: function(c) {
        assert.ok(c.validate());
      },
      &quot;to string&quot;: function(c) {
        assert.equal(c.toString(), &#039;a=b; Expires=Tue, 18 Oct 2011 07:05:03 GMT&#039;);
      },
      &quot;to short string&quot;: function(c) {
        assert.equal(c.cookieString(), &#039;a=b&#039;);
      },
    },
    &quot;with a max-age&quot;: {
      topic: function() {
        var c = new Cookie();
        c.key = &#039;a&#039;;
        c.value = &#039;b&#039;;
        c.setExpires(&quot;Oct 18 2011 07:05:03 GMT&quot;);
        c.maxAge = 12345;
        return c;
      },
      &quot;validates&quot;: function(c) {
        assert.ok(c.validate()); // mabe this one *shouldn&#039;t*?
      },
      &quot;to string&quot;: function(c) {
        assert.equal(c.toString(), &#039;a=b; Expires=Tue, 18 Oct 2011 07:05:03 GMT; Max-Age=12345&#039;);
      },
    },
    &quot;with a bunch of things&quot;: function() {
      var c = new Cookie();
      c.key = &#039;a&#039;;
      c.value = &#039;b&#039;;
      c.setExpires(&quot;Oct 18 2011 07:05:03 GMT&quot;);
      c.maxAge = 12345;
      c.domain = &#039;example.com&#039;;
      c.path = &#039;/foo&#039;;
      c.secure = true;
      c.httpOnly = true;
      c.extensions = [&#039;MyExtension&#039;];
      assert.equal(c.toString(), &#039;a=b; Expires=Tue, 18 Oct 2011 07:05:03 GMT; Max-Age=12345; Domain=example.com; Path=/foo; Secure; HttpOnly; MyExtension&#039;);
    },
    &quot;a host-only cookie&quot;: {
      topic: function() {
        var c = new Cookie();
        c.key = &#039;a&#039;;
        c.value = &#039;b&#039;;
        c.hostOnly = true;
        c.domain = &#039;shouldnt-stringify.example.com&#039;;
        c.path = &#039;/should-stringify&#039;;
        return c;
      },
      &quot;validates&quot;: function(c) {
        assert.ok(c.validate());
      },
      &quot;to string&quot;: function(c) {
        assert.equal(c.toString(), &#039;a=b; Path=/should-stringify&#039;);
      },
    },
    &quot;minutes are &#039;10&#039;&quot;: {
      topic: function() {
        var c = new Cookie();
        c.key = &#039;a&#039;;
        c.value = &#039;b&#039;;
        c.expires = new Date(1284113410000);
        return c;
      },
      &quot;validates&quot;: function(c) {
        assert.ok(c.validate());
      },
      &quot;to string&quot;: function(c) {
        var str = c.toString();
        assert.notEqual(str, &#039;a=b; Expires=Fri, 010 Sep 2010 010:010:010 GMT&#039;);
        assert.equal(str, &#039;a=b; Expires=Fri, 10 Sep 2010 10:10:10 GMT&#039;);
      },
    }
  }
})
.addBatch({
  &quot;TTL with max-age&quot;: function() {
    var c = new Cookie();
    c.maxAge = 123;
    assert.equal(c.TTL(), 123000);
    assert.equal(c.expiryTime(new Date(9000000)), 9123000);
  },
  &quot;TTL with zero max-age&quot;: function() {
    var c = new Cookie();
    c.key = &#039;a&#039;; c.value = &#039;b&#039;;
    c.maxAge = 0; // should be treated as &quot;earliest representable&quot;
    assert.equal(c.TTL(), 0);
    assert.equal(c.expiryTime(new Date(9000000)), -Infinity);
    assert.ok(!c.validate()); // not valid, really: non-zero-digit *DIGIT
  },
  &quot;TTL with negative max-age&quot;: function() {
    var c = new Cookie();
    c.key = &#039;a&#039;; c.value = &#039;b&#039;;
    c.maxAge = -1; // should be treated as &quot;earliest representable&quot;
    assert.equal(c.TTL(), 0);
    assert.equal(c.expiryTime(new Date(9000000)), -Infinity);
    assert.ok(!c.validate()); // not valid, really: non-zero-digit *DIGIT
  },
  &quot;TTL with max-age and expires&quot;: function() {
    var c = new Cookie();
    c.maxAge = 123;
    c.expires = new Date(Date.now()+9000);
    assert.equal(c.TTL(), 123000);
    assert.ok(c.isPersistent());
  },
  &quot;TTL with expires&quot;: function() {
    var c = new Cookie();
    var now = Date.now();
    c.expires = new Date(now+9000);
    assert.equal(c.TTL(now), 9000);
    assert.equal(c.expiryTime(), c.expires.getTime());
  },
  &quot;TTL with old expires&quot;: function() {
    var c = new Cookie();
    c.setExpires(&#039;17 Oct 2010 00:00:00 GMT&#039;);
    assert.ok(c.TTL() &lt; 0);
    assert.ok(c.isPersistent());
  },
  &quot;default TTL&quot;: {
    topic: function() { return new Cookie(); },
    &quot;is Infinite-future&quot;: function(c) { assert.equal(c.TTL(), Infinity) },
    &quot;is a &#039;session&#039; cookie&quot;: function(c) { assert.ok(!c.isPersistent()) },
  },
}).addBatch({
  &quot;Parsing&quot;: {
    &quot;simple&quot;: {
      topic: function() {
        return Cookie.parse(&#039;a=bcd&#039;,true) || null;
      },
      &quot;parsed&quot;: function(c) { assert.ok(c) },
      &quot;key&quot;: function(c) { assert.equal(c.key, &#039;a&#039;) },
      &quot;value&quot;: function(c) { assert.equal(c.value, &#039;bcd&#039;) },
      &quot;no path&quot;: function(c) { assert.equal(c.path, null) },
      &quot;no domain&quot;: function(c) { assert.equal(c.domain, null) },
      &quot;no extensions&quot;: function(c) { assert.ok(!c.extensions) },
    },
    &quot;with expiry&quot;: {
      topic: function() {
        return Cookie.parse(&#039;a=bcd; Expires=Tue, 18 Oct 2011 07:05:03 GMT&#039;,true) || null;
      },
      &quot;parsed&quot;: function(c) { assert.ok(c) },
      &quot;key&quot;: function(c) { assert.equal(c.key, &#039;a&#039;) },
      &quot;value&quot;: function(c) { assert.equal(c.value, &#039;bcd&#039;) },
      &quot;has expires&quot;: function(c) {
        assert.ok(c.expires !== Infinity, &#039;expiry is infinite when it shouldn\&#039;t be&#039;);
        assert.equal(c.expires.getTime(), 1318921503000);
      },
    },
    &quot;with expiry and path&quot;: {
      topic: function() {
        return Cookie.parse(&#039;abc=&quot;xyzzy!&quot;; Expires=Tue, 18 Oct 2011 07:05:03 GMT; Path=/aBc&#039;,true) || null;
      },
      &quot;parsed&quot;: function(c) { assert.ok(c) },
      &quot;key&quot;: function(c) { assert.equal(c.key, &#039;abc&#039;) },
      &quot;value&quot;: function(c) { assert.equal(c.value, &#039;xyzzy!&#039;) },
      &quot;has expires&quot;: function(c) {
        assert.ok(c.expires !== Infinity, &#039;expiry is infinite when it shouldn\&#039;t be&#039;);
        assert.equal(c.expires.getTime(), 1318921503000);
      },
      &quot;has path&quot;: function(c) { assert.equal(c.path, &#039;/aBc&#039;); },
      &quot;no httponly or secure&quot;: function(c) {
        assert.ok(!c.httpOnly);
        assert.ok(!c.secure);
      },
    },
    &quot;with everything&quot;: {
      topic: function() {
        return Cookie.parse(&#039;abc=&quot;xyzzy!&quot;; Expires=Tue, 18 Oct 2011 07:05:03 GMT; Path=/aBc; Domain=example.com; Secure; HTTPOnly; Max-Age=1234; Foo=Bar; Baz&#039;, true) || null;
      },
      &quot;parsed&quot;: function(c) { assert.ok(c) },
      &quot;key&quot;: function(c) { assert.equal(c.key, &#039;abc&#039;) },
      &quot;value&quot;: function(c) { assert.equal(c.value, &#039;xyzzy!&#039;) },
      &quot;has expires&quot;: function(c) {
        assert.ok(c.expires !== Infinity, &#039;expiry is infinite when it shouldn\&#039;t be&#039;);
        assert.equal(c.expires.getTime(), 1318921503000);
      },
      &quot;has path&quot;: function(c) { assert.equal(c.path, &#039;/aBc&#039;); },
      &quot;has domain&quot;: function(c) { assert.equal(c.domain, &#039;example.com&#039;); },
      &quot;has httponly&quot;: function(c) { assert.equal(c.httpOnly, true); },
      &quot;has secure&quot;: function(c) { assert.equal(c.secure, true); },
      &quot;has max-age&quot;: function(c) { assert.equal(c.maxAge, 1234); },
      &quot;has extensions&quot;: function(c) {
        assert.ok(c.extensions);
        assert.equal(c.extensions[0], &#039;Foo=Bar&#039;);
        assert.equal(c.extensions[1], &#039;Baz&#039;);
      },
    },
    &quot;invalid expires&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; Expires=xyzzy&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; Expires=xyzzy&quot;);
        assert.ok(c);
        assert.equal(c.expires, Infinity);
      },
    },
    &quot;zero max-age&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; Max-Age=0&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; Max-Age=0&quot;);
        assert.ok(c);
        assert.equal(c.maxAge, 0);
      },
    },
    &quot;negative max-age&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; Max-Age=-1&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; Max-Age=-1&quot;);
        assert.ok(c);
        assert.equal(c.maxAge, -1);
      },
    },
    &quot;empty domain&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; domain=&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; domain=&quot;);
        assert.ok(c);
        assert.equal(c.domain, null);
      },
    },
    &quot;dot domain&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; domain=.&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; domain=.&quot;);
        assert.ok(c);
        assert.equal(c.domain, null);
      },
    },
    &quot;uppercase domain&quot;: {
      &quot;strict lowercases&quot;: function() {
        var c = Cookie.parse(&quot;a=b; domain=EXAMPLE.COM&quot;);
        assert.ok(c);
        assert.equal(c.domain, &#039;example.com&#039;);
      },
      &quot;non-strict lowercases&quot;: function() {
        var c = Cookie.parse(&quot;a=b; domain=EXAMPLE.COM&quot;);
        assert.ok(c);
        assert.equal(c.domain, &#039;example.com&#039;);
      },
    },
    &quot;trailing dot in domain&quot;: {
      topic: function() {
        return Cookie.parse(&quot;a=b; Domain=example.com.&quot;, true) || null;
      },
      &quot;has the domain&quot;: function(c) { assert.equal(c.domain,&quot;example.com.&quot;) },
      &quot;but doesn&#039;t validate&quot;: function(c) { assert.equal(c.validate(),false) },
    },
    &quot;empty path&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; path=&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; path=&quot;);
        assert.ok(c);
        assert.equal(c.path, null);
      },
    },
    &quot;no-slash path&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; path=xyzzy&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; path=xyzzy&quot;);
        assert.ok(c);
        assert.equal(c.path, null);
      },
    },
    &quot;trailing semi-colons after path&quot;: {
      topic: function () {
        return [
          &quot;a=b; path=/;&quot;,
          &quot;c=d;;;;&quot;
        ];
      },
      &quot;strict&quot;: function (t) {
        assert.ok(!Cookie.parse(t[0], true));
        assert.ok(!Cookie.parse(t[1], true));
      },
      &quot;non-strict&quot;: function (t) {
        var c1 = Cookie.parse(t[0]);
        var c2 = Cookie.parse(t[1]);
        assert.ok(c1);
        assert.ok(c2);
        assert.equal(c1.path, &#039;/&#039;);
      }
    },
    &quot;secure-with-value&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; Secure=xyzzy&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; Secure=xyzzy&quot;);
        assert.ok(c);
        assert.equal(c.secure, true);
      },
    },
    &quot;httponly-with-value&quot;: {
      &quot;strict&quot;: function() { assert.ok(!Cookie.parse(&quot;a=b; HttpOnly=xyzzy&quot;, true)) },
      &quot;non-strict&quot;: function() {
        var c = Cookie.parse(&quot;a=b; HttpOnly=xyzzy&quot;);
        assert.ok(c);
        assert.equal(c.httpOnly, true);
      },
    },
    &quot;garbage&quot;: {
      topic: function() {
        return Cookie.parse(&quot;\x08&quot;, true) || null;
      },
      &quot;doesn&#039;t parse&quot;: function(c) { assert.equal(c,null) },
    },
    &quot;public suffix domain&quot;: {
      topic: function() {
        return Cookie.parse(&quot;a=b; domain=kyoto.jp&quot;, true) || null;
      },
      &quot;parses fine&quot;: function(c) {
        assert.ok(c);
        assert.equal(c.domain, &#039;kyoto.jp&#039;);
      },
      &quot;but fails validation&quot;: function(c) {
        assert.ok(c);
        assert.ok(!c.validate());
      },
    },
    &quot;Ironically, Google &#039;GAPS&#039; cookie has very little whitespace&quot;: {
      topic: function() {
        return Cookie.parse(&quot;GAPS=1:A1aaaaAaAAa1aaAaAaaAAAaaa1a11a:aaaAaAaAa-aaaA1-;Path=/;Expires=Thu, 17-Apr-2014 02:12:29 GMT;Secure;HttpOnly&quot;);
      },
      &quot;parsed&quot;: function(c) { assert.ok(c) },
      &quot;key&quot;: function(c) { assert.equal(c.key, &#039;GAPS&#039;) },
      &quot;value&quot;: function(c) { assert.equal(c.value, &#039;1:A1aaaaAaAAa1aaAaAaaAAAaaa1a11a:aaaAaAaAa-aaaA1-&#039;) },
      &quot;path&quot;: function(c) {
        assert.notEqual(c.path, &#039;/;Expires&#039;); // BUG
        assert.equal(c.path, &#039;/&#039;);
      },
      &quot;expires&quot;: function(c) {
        assert.notEqual(c.expires, Infinity);
        assert.equal(c.expires.getTime(), 1397700749000);
      },
      &quot;secure&quot;: function(c) { assert.ok(c.secure) },
      &quot;httponly&quot;: function(c) { assert.ok(c.httpOnly) },
    },
    &quot;lots of equal signs&quot;: {
      topic: function() {
        return Cookie.parse(&quot;queryPref=b=c&amp;d=e; Path=/f=g; Expires=Thu, 17 Apr 2014 02:12:29 GMT; HttpOnly&quot;);
      },
      &quot;parsed&quot;: function(c) { assert.ok(c) },
      &quot;key&quot;: function(c) { assert.equal(c.key, &#039;queryPref&#039;) },
      &quot;value&quot;: function(c) { assert.equal(c.value, &#039;b=c&amp;d=e&#039;) },
      &quot;path&quot;: function(c) {
        assert.equal(c.path, &#039;/f=g&#039;);
      },
      &quot;expires&quot;: function(c) {
        assert.notEqual(c.expires, Infinity);
        assert.equal(c.expires.getTime(), 1397700749000);
      },
      &quot;httponly&quot;: function(c) { assert.ok(c.httpOnly) },
    },
    &quot;spaces in value&quot;: {
      &quot;strict&quot;: {
        topic: function() {
          return Cookie.parse(&#039;a=one two three&#039;,true) || null;
        },
        &quot;did not parse&quot;: function(c) { assert.isNull(c) },
      },
      &quot;non-strict&quot;: {
        topic: function() {
          return Cookie.parse(&#039;a=one two three&#039;,false) || null;
        },
        &quot;parsed&quot;: function(c) { assert.ok(c) },
        &quot;key&quot;: function(c) { assert.equal(c.key, &#039;a&#039;) },
        &quot;value&quot;: function(c) { assert.equal(c.value, &#039;one two three&#039;) },
        &quot;no path&quot;: function(c) { assert.equal(c.path, null) },
        &quot;no domain&quot;: function(c) { assert.equal(c.domain, null) },
        &quot;no extensions&quot;: function(c) { assert.ok(!c.extensions) },
      },
    },
    &quot;quoted spaces in value&quot;: {
      &quot;strict&quot;: {
        topic: function() {
          return Cookie.parse(&#039;a=&quot;one two three&quot;&#039;,true) || null;
        },
        &quot;did not parse&quot;: function(c) { assert.isNull(c) },
      },
      &quot;non-strict&quot;: {
        topic: function() {
          return Cookie.parse(&#039;a=&quot;one two three&quot;&#039;,false) || null;
        },
        &quot;parsed&quot;: function(c) { assert.ok(c) },
        &quot;key&quot;: function(c) { assert.equal(c.key, &#039;a&#039;) },
        &quot;value&quot;: function(c) { assert.equal(c.value, &#039;one two three&#039;) },
        &quot;no path&quot;: function(c) { assert.equal(c.path, null) },
        &quot;no domain&quot;: function(c) { assert.equal(c.domain, null) },
        &quot;no extensions&quot;: function(c) { assert.ok(!c.extensions) },
      }
    },
    &quot;non-ASCII in value&quot;: {
      &quot;strict&quot;: {
        topic: function() {
          return Cookie.parse(&#039;farbe=weiß&#039;,true) || null;
        },
        &quot;did not parse&quot;: function(c) { assert.isNull(c) },
      },
      &quot;non-strict&quot;: {
        topic: function() {
          return Cookie.parse(&#039;farbe=weiß&#039;,false) || null;
        },
        &quot;parsed&quot;: function(c) { assert.ok(c) },
        &quot;key&quot;: function(c) { assert.equal(c.key, &#039;farbe&#039;) },
        &quot;value&quot;: function(c) { assert.equal(c.value, &#039;weiß&#039;) },
        &quot;no path&quot;: function(c) { assert.equal(c.path, null) },
        &quot;no domain&quot;: function(c) { assert.equal(c.domain, null) },
        &quot;no extensions&quot;: function(c) { assert.ok(!c.extensions) },
      },
    },
  }
})
.addBatch({
  &quot;domain normalization&quot;: {
    &quot;simple&quot;: function() {
      var c = new Cookie();
      c.domain = &quot;EXAMPLE.com&quot;;
      assert.equal(c.canonicalizedDomain(), &quot;example.com&quot;);
    },
    &quot;extra dots&quot;: function() {
      var c = new Cookie();
      c.domain = &quot;.EXAMPLE.com&quot;;
      assert.equal(c.cdomain(), &quot;example.com&quot;);
    },
    &quot;weird trailing dot&quot;: function() {
      var c = new Cookie();
      c.domain = &quot;EXAMPLE.ca.&quot;;
      assert.equal(c.canonicalizedDomain(), &quot;example.ca.&quot;);
    },
    &quot;weird internal dots&quot;: function() {
      var c = new Cookie();
      c.domain = &quot;EXAMPLE...ca.&quot;;
      assert.equal(c.canonicalizedDomain(), &quot;example...ca.&quot;);
    },
    &quot;IDN&quot;: function() {
      var c = new Cookie();
      c.domain = &quot;δοκιμή.δοκιμή&quot;; // &quot;test.test&quot; in greek
      assert.equal(c.canonicalizedDomain(), &quot;xn--jxalpdlp.xn--jxalpdlp&quot;);
    }
  }
})
.addBatch({
  &quot;Domain Match&quot;:matchVows(tough.domainMatch, [
    // str,          dom,          expect
    [&quot;example.com&quot;, &quot;example.com&quot;, true],
    [&quot;eXaMpLe.cOm&quot;, &quot;ExAmPlE.CoM&quot;, true],
    [&quot;no.ca&quot;, &quot;yes.ca&quot;, false],
    [&quot;wwwexample.com&quot;, &quot;example.com&quot;, false],
    [&quot;www.example.com&quot;, &quot;example.com&quot;, true],
    [&quot;example.com&quot;, &quot;www.example.com&quot;, false],
    [&quot;www.subdom.example.com&quot;, &quot;example.com&quot;, true],
    [&quot;www.subdom.example.com&quot;, &quot;subdom.example.com&quot;, true],
    [&quot;example.com&quot;, &quot;example.com.&quot;, false], // RFC6265 S4.1.2.3
    [&quot;192.168.0.1&quot;, &quot;168.0.1&quot;, false], // S5.1.3 &quot;The string is a host name&quot;
    [null, &quot;example.com&quot;, null],
    [&quot;example.com&quot;, null, null],
    [null, null, null],
    [undefined, undefined, null],
  ])
})
.addBatch({
  &quot;default-path&quot;: defaultPathVows([
    [null,&quot;/&quot;],
    [&quot;/&quot;,&quot;/&quot;],
    [&quot;/file&quot;,&quot;/&quot;],
    [&quot;/dir/file&quot;,&quot;/dir&quot;],
    [&quot;noslash&quot;,&quot;/&quot;],
  ])
})
.addBatch({
  &quot;Path-Match&quot;: matchVows(tough.pathMatch, [
    // request, cookie, match
    [&quot;/&quot;,&quot;/&quot;,true],
    [&quot;/dir&quot;,&quot;/&quot;,true],
    [&quot;/&quot;,&quot;/dir&quot;,false],
    [&quot;/dir/&quot;,&quot;/dir/&quot;, true],
    [&quot;/dir/file&quot;,&quot;/dir/&quot;,true],
    [&quot;/dir/file&quot;,&quot;/dir&quot;,true],
    [&quot;/directory&quot;,&quot;/dir&quot;,false],
  ])
})
.addBatch({
  &quot;Cookie Sorting&quot;: {
    topic: function() {
      var cookies = [];
      var now = Date.now();
      cookies.push(Cookie.parse(&quot;a=0; Domain=example.com&quot;));
      cookies.push(Cookie.parse(&quot;b=1; Domain=www.example.com&quot;));
      cookies.push(Cookie.parse(&quot;c=2; Domain=example.com; Path=/pathA&quot;));
      cookies.push(Cookie.parse(&quot;d=3; Domain=www.example.com; Path=/pathA&quot;));
      cookies.push(Cookie.parse(&quot;e=4; Domain=example.com; Path=/pathA/pathB&quot;));
      cookies.push(Cookie.parse(&quot;f=5; Domain=www.example.com; Path=/pathA/pathB&quot;));

      // force a stable creation time consistent with the order above since
      // some may have been created at now + 1ms.
      var i = cookies.length;
      cookies.forEach(function(cookie) {
        cookie.creation = new Date(now - 100*(i--));
      });

      // weak shuffle:
      cookies = cookies.sort(function(){return Math.random()-0.5});

      cookies = cookies.sort(tough.cookieCompare);
      return cookies;
    },
    &quot;got&quot;: function(cookies) {
      assert.lengthOf(cookies, 6);
      var names = cookies.map(function(c) {return c.key});
      assert.deepEqual(names, [&#039;e&#039;,&#039;f&#039;,&#039;c&#039;,&#039;d&#039;,&#039;a&#039;,&#039;b&#039;]);
    },
  }
})
.addBatch({
  &quot;CookieJar&quot;: {
    &quot;Setting a basic cookie&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=example.com; Path=/&quot;);
        assert.strictEqual(c.hostOnly, null);
        assert.instanceOf(c.creation, Date);
        assert.strictEqual(c.lastAccessed, null);
        c.creation = new Date(Date.now()-10000);
        cj.setCookie(c, &#039;http://example.com/index.html&#039;, this.callback);
      },
      &quot;works&quot;: function(c) { assert.instanceOf(c,Cookie) }, // C is for Cookie, good enough for me
      &quot;gets timestamped&quot;: function(c) {
        assert.ok(c.creation);
        assert.ok(Date.now() - c.creation.getTime() &lt; 5000); // recently stamped
        assert.ok(c.lastAccessed);
        assert.equal(c.creation, c.lastAccessed);
        assert.equal(c.TTL(), Infinity);
        assert.ok(!c.isPersistent());
      },
    },
    &quot;Setting a no-path cookie&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=example.com&quot;);
        assert.strictEqual(c.hostOnly, null);
        assert.instanceOf(c.creation, Date);
        assert.strictEqual(c.lastAccessed, null);
        c.creation = new Date(Date.now()-10000);
        cj.setCookie(c, &#039;http://example.com/index.html&#039;, this.callback);
      },
      &quot;domain&quot;: function(c) { assert.equal(c.domain, &#039;example.com&#039;) },
      &quot;path is /&quot;: function(c) { assert.equal(c.path, &#039;/&#039;) },
      &quot;path was derived&quot;: function(c) { assert.strictEqual(c.pathIsDefault, true) },
    },
    &quot;Setting a cookie already marked as host-only&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=example.com&quot;);
        assert.strictEqual(c.hostOnly, null);
        assert.instanceOf(c.creation, Date);
        assert.strictEqual(c.lastAccessed, null);
        c.creation = new Date(Date.now()-10000);
        c.hostOnly = true;
        cj.setCookie(c, &#039;http://example.com/index.html&#039;, this.callback);
      },
      &quot;domain&quot;: function(c) { assert.equal(c.domain, &#039;example.com&#039;) },
      &quot;still hostOnly&quot;: function(c) { assert.strictEqual(c.hostOnly, true) },
    },
    &quot;Setting a session cookie&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b&quot;);
        assert.strictEqual(c.path, null);
        cj.setCookie(c, &#039;http://www.example.com/dir/index.html&#039;, this.callback);
      },
      &quot;works&quot;: function(c) { assert.instanceOf(c,Cookie) },
      &quot;gets the domain&quot;: function(c) { assert.equal(c.domain, &#039;www.example.com&#039;) },
      &quot;gets the default path&quot;: function(c) { assert.equal(c.path, &#039;/dir&#039;) },
      &quot;is &#039;hostOnly&#039;&quot;: function(c) { assert.ok(c.hostOnly) },
    },
    &quot;Setting wrong domain cookie&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=fooxample.com; Path=/&quot;);
        cj.setCookie(c, &#039;http://example.com/index.html&#039;, this.callback);
      },
      &quot;fails&quot;: function(err,c) {
        assert.ok(err.message.match(/domain/i));
        assert.ok(!c);
      },
    },
    &quot;Setting sub-domain cookie&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=www.example.com; Path=/&quot;);
        cj.setCookie(c, &#039;http://example.com/index.html&#039;, this.callback);
      },
      &quot;fails&quot;: function(err,c) {
        assert.ok(err.message.match(/domain/i));
        assert.ok(!c);
      },
    },
    &quot;Setting super-domain cookie&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=example.com; Path=/&quot;);
        cj.setCookie(c, &#039;http://www.app.example.com/index.html&#039;, this.callback);
      },
      &quot;success&quot;: function(err,c) {
        assert.ok(!err);
        assert.equal(c.domain, &#039;example.com&#039;);
      },
    },
    &quot;Setting a sub-path cookie on a super-domain&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=example.com; Path=/subpath&quot;);
        assert.strictEqual(c.hostOnly, null);
        assert.instanceOf(c.creation, Date);
        assert.strictEqual(c.lastAccessed, null);
        c.creation = new Date(Date.now()-10000);
        cj.setCookie(c, &#039;http://www.example.com/index.html&#039;, this.callback);
      },
      &quot;domain is super-domain&quot;: function(c) { assert.equal(c.domain, &#039;example.com&#039;) },
      &quot;path is /subpath&quot;: function(c) { assert.equal(c.path, &#039;/subpath&#039;) },
      &quot;path was NOT derived&quot;: function(c) { assert.strictEqual(c.pathIsDefault, null) },
    },
    &quot;Setting HttpOnly cookie over non-HTTP API&quot;: {
      topic: function() {
        var cj = new CookieJar();
        var c = Cookie.parse(&quot;a=b; Domain=example.com; Path=/; HttpOnly&quot;);
        cj.setCookie(c, &#039;http://example.com/index.html&#039;, {http:false}, this.callback);
      },
      &quot;fails&quot;: function(err,c) {
        assert.match(err.message, /HttpOnly/i);
        assert.ok(!c);
      },
    },
  },
  &quot;Cookie Jar store eight cookies&quot;: {
    topic: function() {
      var cj = new CookieJar();
      var ex = &#039;http://example.com/index.html&#039;;
      var tasks = [];
      tasks.push(function(next) {
        cj.setCookie(&#039;a=1; Domain=example.com; Path=/&#039;,ex,at(0),next);
      });
      tasks.push(function(next) {
        cj.setCookie(&#039;b=2; Domain=example.com; Path=/; HttpOnly&#039;,ex,at(1000),next);
      });
      tasks.push(function(next) {
        cj.setCookie(&#039;c=3; Domain=example.com; Path=/; Secure&#039;,ex,at(2000),next);
      });
      tasks.push(function(next) { // path
        cj.setCookie(&#039;d=4; Domain=example.com; Path=/foo&#039;,ex,at(3000),next);
      });
      tasks.push(function(next) { // host only
        cj.setCookie(&#039;e=5&#039;,ex,at(4000),next);
      });
      tasks.push(function(next) { // other domain
        cj.setCookie(&#039;f=6; Domain=nodejs.org; Path=/&#039;,&#039;http://nodejs.org&#039;,at(5000),next);
      });
      tasks.push(function(next) { // expired
        cj.setCookie(&#039;g=7; Domain=example.com; Path=/; Expires=Tue, 18 Oct 2011 00:00:00 GMT&#039;,ex,at(6000),next);
      });
      tasks.push(function(next) { // expired via Max-Age
        cj.setCookie(&#039;h=8; Domain=example.com; Path=/; Max-Age=1&#039;,ex,next);
      });
      var cb = this.callback;
      async.parallel(tasks, function(err,results){
        setTimeout(function() {
          cb(err,cj,results);
        }, 2000); // so that &#039;h=8&#039; expires
      });
    },
    &quot;setup ok&quot;: function(err,cj,results) {
      assert.ok(!err);
      assert.ok(cj);
      assert.ok(results);
    },
    &quot;then retrieving for http://nodejs.org&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;http://nodejs.org&#039;,this.callback);
      },
      &quot;get a nodejs cookie&quot;: function(cookies) {
        assert.lengthOf(cookies, 1);
        var cookie = cookies[0];
        assert.equal(cookie.domain, &#039;nodejs.org&#039;);
      },
    },
    &quot;then retrieving for https://example.com&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;https://example.com&#039;,{secure:true},this.callback);
      },
      &quot;get a secure example cookie with others&quot;: function(cookies) {
        var names = cookies.map(function(c) {return c.key});
        assert.deepEqual(names, [&#039;a&#039;,&#039;b&#039;,&#039;c&#039;,&#039;e&#039;]);
      },
    },
    &quot;then retrieving for https://example.com (missing options)&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;https://example.com&#039;,this.callback);
      },
      &quot;get a secure example cookie with others&quot;: function(cookies) {
        var names = cookies.map(function(c) {return c.key});
        assert.deepEqual(names, [&#039;a&#039;,&#039;b&#039;,&#039;c&#039;,&#039;e&#039;]);
      },
    },
    &quot;then retrieving for http://example.com&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;http://example.com&#039;,this.callback);
      },
      &quot;get a bunch of cookies&quot;: function(cookies) {
        var names = cookies.map(function(c) {return c.key});
        assert.deepEqual(names, [&#039;a&#039;,&#039;b&#039;,&#039;e&#039;]);
      },
    },
    &quot;then retrieving for http://EXAMPlE.com&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;http://EXAMPlE.com&#039;,this.callback);
      },
      &quot;get a bunch of cookies&quot;: function(cookies) {
        var names = cookies.map(function(c) {return c.key});
        assert.deepEqual(names, [&#039;a&#039;,&#039;b&#039;,&#039;e&#039;]);
      },
    },
    &quot;then retrieving for http://example.com, non-HTTP&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;http://example.com&#039;,{http:false},this.callback);
      },
      &quot;get a bunch of cookies&quot;: function(cookies) {
        var names = cookies.map(function(c) {return c.key});
        assert.deepEqual(names, [&#039;a&#039;,&#039;e&#039;]);
      },
    },
    &quot;then retrieving for http://example.com/foo/bar&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;http://example.com/foo/bar&#039;,this.callback);
      },
      &quot;get a bunch of cookies&quot;: function(cookies) {
        var names = cookies.map(function(c) {return c.key});
        assert.deepEqual(names, [&#039;d&#039;,&#039;a&#039;,&#039;b&#039;,&#039;e&#039;]);
      },
    },
    &quot;then retrieving for http://example.com as a string&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookieString(&#039;http://example.com&#039;,this.callback);
      },
      &quot;get a single string&quot;: function(cookieHeader) {
        assert.equal(cookieHeader, &quot;a=1; b=2; e=5&quot;);
      },
    },
    &quot;then retrieving for http://example.com as a set-cookie header&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getSetCookieStrings(&#039;http://example.com&#039;,this.callback);
      },
      &quot;get a single string&quot;: function(cookieHeaders) {
        assert.lengthOf(cookieHeaders, 3);
        assert.equal(cookieHeaders[0], &quot;a=1; Domain=example.com; Path=/&quot;);
        assert.equal(cookieHeaders[1], &quot;b=2; Domain=example.com; Path=/; HttpOnly&quot;);
        assert.equal(cookieHeaders[2], &quot;e=5; Path=/&quot;);
      },
    },
    &quot;then retrieving for http://www.example.com/&quot;: {
      topic: function(cj,oldResults) {
        assert.ok(oldResults);
        cj.getCookies(&#039;http://www.example.com/foo/bar&#039;,this.callback);
      },
      &quot;get a bunch of cookies&quot;: function(cookies) {
        var names = cookies.map(function(c) {return c.key});
        assert.deepEqual(names, [&#039;d&#039;,&#039;a&#039;,&#039;b&#039;]); // note lack of &#039;e&#039;
      },
    },
  },
  &quot;Repeated names&quot;: {
    topic: function() {
      var cb = this.callback;
      var cj = new CookieJar();
      var ex = &#039;http://www.example.com/&#039;;
      var sc = cj.setCookie;
      var tasks = [];
      var now = Date.now();
      tasks.push(sc.bind(cj,&#039;aaaa=xxxx&#039;,ex,at(0)));
      tasks.push(sc.bind(cj,&#039;aaaa=1111; Domain=www.example.com&#039;,ex,at(1000)));
      tasks.push(sc.bind(cj,&#039;aaaa=2222; Domain=example.com&#039;,ex,at(2000)));
      tasks.push(sc.bind(cj,&#039;aaaa=3333; Domain=www.example.com; Path=/pathA&#039;,ex,at(3000)));
      async.series(tasks,function(err,results) {
        results = results.filter(function(e) {return e !== undefined});
        cb(err,{cj:cj, cookies:results, now:now});
      });
    },
    &quot;all got set&quot;: function(err,t) {
      assert.lengthOf(t.cookies,4);
    },
    &quot;then getting &#039;em back&quot;: {
      topic: function(t) {
        var cj = t.cj;
        cj.getCookies(&#039;http://www.example.com/pathA&#039;,this.callback);
      },
      &quot;there&#039;s just three&quot;: function (err,cookies) {
        var vals = cookies.map(function(c) {return c.value});
        // may break with sorting; sorting should put 3333 first due to longest path:
        assert.deepEqual(vals, [&#039;3333&#039;,&#039;1111&#039;,&#039;2222&#039;]);
      }
    },
  },
  &quot;CookieJar setCookie errors&quot;: {
    &quot;public-suffix domain&quot;: {
      topic: function() {
        var cj = new CookieJar();
        cj.setCookie(&#039;i=9; Domain=kyoto.jp; Path=/&#039;,&#039;kyoto.jp&#039;,this.callback);
      },
      &quot;errors&quot;: function(err,cookie) {
        assert.ok(err);
        assert.ok(!cookie);
        assert.match(err.message, /public suffix/i);
      },
    },
    &quot;wrong domain&quot;: {
      topic: function() {
        var cj = new CookieJar();
        cj.setCookie(&#039;j=10; Domain=google.com; Path=/&#039;,&#039;google.ca&#039;,this.callback);
      },
      &quot;errors&quot;: function(err,cookie) {
        assert.ok(err);
        assert.ok(!cookie);
        assert.match(err.message, /not in this host&#039;s domain/i);
      },
    },
    &quot;old cookie is HttpOnly&quot;: {
      topic: function() {
        var cb = this.callback;
        var next = function (err,c) {
          c = null;
          return cb(err,cj);
        };
        var cj = new CookieJar();
        cj.setCookie(&#039;k=11; Domain=example.ca; Path=/; HttpOnly&#039;,&#039;http://example.ca&#039;,{http:true},next);
      },
      &quot;initial cookie is set&quot;: function(err,cj) {
        assert.ok(!err);
        assert.ok(cj);
      },
      &quot;but when trying to overwrite&quot;: {
        topic: function(cj) {
          var cb = this.callback;
          var next = function(err,c) {
            c = null;
            cb(null,err);
          };
          cj.setCookie(&#039;k=12; Domain=example.ca; Path=/&#039;,&#039;http://example.ca&#039;,{http:false},next);
        },
        &quot;it&#039;s an error&quot;: function(err) {
          assert.ok(err);
        },
        &quot;then, checking the original&quot;: {
          topic: function(ignored,cj) {
            assert.ok(cj instanceof CookieJar);
            cj.getCookies(&#039;http://example.ca&#039;,{http:true},this.callback);
          },
          &quot;cookie has original value&quot;: function(err,cookies) {
            assert.equal(err,null);
            assert.lengthOf(cookies, 1);
            assert.equal(cookies[0].value,11);
          },
        },
      },
    },
  },
})
.addBatch({
  &quot;JSON&quot;: {
    &quot;serialization&quot;: {
      topic: function() {
        var c = Cookie.parse(&#039;alpha=beta; Domain=example.com; Path=/foo; Expires=Tue, 19 Jan 2038 03:14:07 GMT; HttpOnly&#039;);
        return JSON.stringify(c);
      },
      &quot;gives a string&quot;: function(str) {
        assert.equal(typeof str, &quot;string&quot;);
      },
      &quot;date is in ISO format&quot;: function(str) {
        assert.match(str, /&quot;expires&quot;:&quot;2038-01-19T03:14:07\.000Z&quot;/, &#039;expires is in ISO format&#039;);
      },
    },
    &quot;deserialization&quot;: {
      topic: function() {
        var json = &#039;{&quot;key&quot;:&quot;alpha&quot;,&quot;value&quot;:&quot;beta&quot;,&quot;domain&quot;:&quot;example.com&quot;,&quot;path&quot;:&quot;/foo&quot;,&quot;expires&quot;:&quot;2038-01-19T03:14:07.000Z&quot;,&quot;httpOnly&quot;:true,&quot;lastAccessed&quot;:2000000000123}&#039;;
        return Cookie.fromJSON(json);
      },
      &quot;works&quot;: function(c) {
        assert.ok(c);
      },
      &quot;key&quot;: function(c) { assert.equal(c.key, &quot;alpha&quot;) },
      &quot;value&quot;: function(c) { assert.equal(c.value, &quot;beta&quot;) },
      &quot;domain&quot;: function(c) { assert.equal(c.domain, &quot;example.com&quot;) },
      &quot;path&quot;: function(c) { assert.equal(c.path, &quot;/foo&quot;) },
      &quot;httpOnly&quot;: function(c) { assert.strictEqual(c.httpOnly, true) },
      &quot;secure&quot;: function(c) { assert.strictEqual(c.secure, false) },
      &quot;hostOnly&quot;: function(c) { assert.strictEqual(c.hostOnly, null) },
      &quot;expires is a date object&quot;: function(c) {
        assert.equal(c.expires.getTime(), 2147483647000);
      },
      &quot;lastAccessed is a date object&quot;: function(c) {
        assert.equal(c.lastAccessed.getTime(), 2000000000123);
      },
      &quot;creation defaulted&quot;: function(c) {
        assert.ok(c.creation.getTime());
      }
    },
    &quot;null deserialization&quot;: {
      topic: function() {
        return Cookie.fromJSON(null);
      },
      &quot;is null&quot;: function(cookie) {
        assert.equal(cookie,null);
      },
    },
  },
  &quot;expiry deserialization&quot;: {
    &quot;Infinity&quot;: {
      topic: Cookie.fromJSON.bind(null, &#039;{&quot;expires&quot;:&quot;Infinity&quot;}&#039;),
      &quot;is infinite&quot;: function(c) {
        assert.strictEqual(c.expires, &quot;Infinity&quot;);
        assert.equal(c.expires, Infinity);
      },
    },
  },
  &quot;maxAge serialization&quot;: {
    topic: function() {
      return function(toSet) {
        var c = new Cookie();
        c.key = &#039;foo&#039;; c.value = &#039;bar&#039;;
        c.setMaxAge(toSet);
        return JSON.stringify(c);
      };
    },
    &quot;zero&quot;: {
      topic: function(f) { return f(0) },
      &quot;looks good&quot;: function(str) {
        assert.match(str, /&quot;maxAge&quot;:0/);
      },
    },
    &quot;Infinity&quot;: {
      topic: function(f) { return f(Infinity) },
      &quot;looks good&quot;: function(str) {
        assert.match(str, /&quot;maxAge&quot;:&quot;Infinity&quot;/);
      },
    },
    &quot;-Infinity&quot;: {
      topic: function(f) { return f(-Infinity) },
      &quot;looks good&quot;: function(str) {
        assert.match(str, /&quot;maxAge&quot;:&quot;-Infinity&quot;/);
      },
    },
    &quot;null&quot;: {
      topic: function(f) { return f(null) },
      &quot;looks good&quot;: function(str) {
        assert.match(str, /&quot;maxAge&quot;:null/);
      },
    },
  },
  &quot;maxAge deserialization&quot;: {
    &quot;number&quot;: {
      topic: Cookie.fromJSON.bind(null,&#039;{&quot;key&quot;:&quot;foo&quot;,&quot;value&quot;:&quot;bar&quot;,&quot;maxAge&quot;:123}&#039;),
      &quot;is the number&quot;: function(c) {
        assert.strictEqual(c.maxAge, 123);
      },
    },
    &quot;null&quot;: {
      topic: Cookie.fromJSON.bind(null,&#039;{&quot;key&quot;:&quot;foo&quot;,&quot;value&quot;:&quot;bar&quot;,&quot;maxAge&quot;:null}&#039;),
      &quot;is null&quot;: function(c) {
        assert.strictEqual(c.maxAge, null);
      },
    },
    &quot;less than zero&quot;: {
      topic: Cookie.fromJSON.bind(null,&#039;{&quot;key&quot;:&quot;foo&quot;,&quot;value&quot;:&quot;bar&quot;,&quot;maxAge&quot;:-123}&#039;),
      &quot;is -123&quot;: function(c) {
        assert.strictEqual(c.maxAge, -123);
      },
    },
    &quot;Infinity&quot;: {
      topic: Cookie.fromJSON.bind(null,&#039;{&quot;key&quot;:&quot;foo&quot;,&quot;value&quot;:&quot;bar&quot;,&quot;maxAge&quot;:&quot;Infinity&quot;}&#039;),
      &quot;is inf-as-string&quot;: function(c) {
        assert.strictEqual(c.maxAge, &quot;Infinity&quot;);
      },
    },
    &quot;-Infinity&quot;: {
      topic: Cookie.fromJSON.bind(null,&#039;{&quot;key&quot;:&quot;foo&quot;,&quot;value&quot;:&quot;bar&quot;,&quot;maxAge&quot;:&quot;-Infinity&quot;}&#039;),
      &quot;is inf-as-string&quot;: function(c) {
        assert.strictEqual(c.maxAge, &quot;-Infinity&quot;);
      },
    },
  }
})
.addBatch({
  &quot;permuteDomain&quot;: {
    &quot;base case&quot;: {
      topic: tough.permuteDomain.bind(null,&#039;example.com&#039;),
      &quot;got the domain&quot;: function(list) {
        assert.deepEqual(list, [&#039;example.com&#039;]);
      },
    },
    &quot;two levels&quot;: {
      topic: tough.permuteDomain.bind(null,&#039;foo.bar.example.com&#039;),
      &quot;got three things&quot;: function(list) {
        assert.deepEqual(list, [&#039;example.com&#039;,&#039;bar.example.com&#039;,&#039;foo.bar.example.com&#039;]);
      },
    },
    &quot;invalid domain&quot;: {
      topic: tough.permuteDomain.bind(null,&#039;foo.bar.example.localduhmain&#039;),
      &quot;got three things&quot;: function(list) {
        assert.equal(list, null);
      },
    },
  },
  &quot;permutePath&quot;: {
    &quot;base case&quot;: {
      topic: tough.permutePath.bind(null,&#039;/&#039;),
      &quot;just slash&quot;: function(list) {
        assert.deepEqual(list,[&#039;/&#039;]);
      },
    },
    &quot;single case&quot;: {
      topic: tough.permutePath.bind(null,&#039;/foo&#039;),
      &quot;two things&quot;: function(list) {
        assert.deepEqual(list,[&#039;/foo&#039;,&#039;/&#039;]);
      },
      &quot;path matching&quot;: function(list) {
        list.forEach(function(e) {
          assert.ok(tough.pathMatch(&#039;/foo&#039;,e));
        });
      },
    },
    &quot;double case&quot;: {
      topic: tough.permutePath.bind(null,&#039;/foo/bar&#039;),
      &quot;four things&quot;: function(list) {
        assert.deepEqual(list,[&#039;/foo/bar&#039;,&#039;/foo&#039;,&#039;/&#039;]);
      },
      &quot;path matching&quot;: function(list) {
        list.forEach(function(e) {
          assert.ok(tough.pathMatch(&#039;/foo/bar&#039;,e));
        });
      },
    },
    &quot;trailing slash&quot;: {
      topic: tough.permutePath.bind(null,&#039;/foo/bar/&#039;),
      &quot;three things&quot;: function(list) {
        assert.deepEqual(list,[&#039;/foo/bar&#039;,&#039;/foo&#039;,&#039;/&#039;]);
      },
      &quot;path matching&quot;: function(list) {
        list.forEach(function(e) {
          assert.ok(tough.pathMatch(&#039;/foo/bar/&#039;,e));
        });
      },
    },
  }
})
.addBatch({
  &quot;Issue 1&quot;: {
    topic: function() {
      var cj = new CookieJar();
      cj.setCookie(&#039;hello=world; path=/some/path/&#039;, &#039;http://domain/some/path/file&#039;, function(err,cookie) {
        this.callback(err,{cj:cj, cookie:cookie});
      }.bind(this));
    },
    &quot;stored a cookie&quot;: function(t) {
      assert.ok(t.cookie);
    },
    &quot;cookie&#039;s path was modified to remove unnecessary slash&quot;: function(t) {
      assert.equal(t.cookie.path, &#039;/some/path&#039;);
    },
    &quot;getting it back&quot;: {
      topic: function(t) {
        t.cj.getCookies(&#039;http://domain/some/path/file&#039;, function(err,cookies) {
          this.callback(err, {cj:t.cj, cookies:cookies||[]});
        }.bind(this));
      },
      &quot;got one cookie&quot;: function(t) {
        assert.lengthOf(t.cookies, 1);
      },
      &quot;it&#039;s the right one&quot;: function(t) {
        var c = t.cookies[0];
        assert.equal(c.key, &#039;hello&#039;);
        assert.equal(c.value, &#039;world&#039;);
      },
    }
  }
})
.addBatch({
  &quot;expiry option&quot;: {
    topic: function() {
      var cb = this.callback;
      var cj = new CookieJar();
      cj.setCookie(&#039;near=expiry; Domain=example.com; Path=/; Max-Age=1&#039;,&#039;http://www.example.com&#039;,at(-1), function(err,cookie) {

        cb(err, {cj:cj, cookie:cookie});
      });
    },
    &quot;set the cookie&quot;: function(t) {
      assert.ok(t.cookie, &quot;didn&#039;t set?!&quot;);
      assert.equal(t.cookie.key, &#039;near&#039;);
    },
    &quot;then, retrieving&quot;: {
      topic: function(t) {
        var cb = this.callback;
        setTimeout(function() {
          t.cj.getCookies(&#039;http://www.example.com&#039;, {http:true, expire:false}, function(err,cookies) {
            t.cookies = cookies;
            cb(err,t);
          });
        },2000);
      },
      &quot;got the cookie&quot;: function(t) {
        assert.lengthOf(t.cookies, 1);
        assert.equal(t.cookies[0].key, &#039;near&#039;);
      },
    }
  }
})
.addBatch({
  &quot;trailing semi-colon set into cj&quot;: {
    topic: function () {
      var cb = this.callback;
      var cj = new CookieJar();
      var ex = &#039;http://www.example.com&#039;;
      var tasks = [];
      tasks.push(function(next) {
        cj.setCookie(&#039;broken_path=testme; path=/;&#039;,ex,at(-1),next);
      });
      tasks.push(function(next) {
        cj.setCookie(&#039;b=2; Path=/;;;;&#039;,ex,at(-1),next);
      });
      async.parallel(tasks, function (err, cookies) {
        cb(null, {
          cj: cj,
          cookies: cookies
        });
      });
    },
    &quot;check number of cookies&quot;: function (t) {
      assert.lengthOf(t.cookies, 2, &quot;didn&#039;t set&quot;);
    },
    &quot;check *broken_path* was set properly&quot;: function (t) {
      assert.equal(t.cookies[0].key, &quot;broken_path&quot;);
      assert.equal(t.cookies[0].value, &quot;testme&quot;);
      assert.equal(t.cookies[0].path, &quot;/&quot;);
    },
    &quot;check *b* was set properly&quot;: function (t) {
      assert.equal(t.cookies[1].key, &quot;b&quot;);
      assert.equal(t.cookies[1].value, &quot;2&quot;);
      assert.equal(t.cookies[1].path, &quot;/&quot;);
    },
    &quot;retrieve the cookie&quot;: {
      topic: function (t) {
        var cb = this.callback;
        t.cj.getCookies(&#039;http://www.example.com&#039;, {}, function (err, cookies) {
          t.cookies = cookies;
          cb(err, t);
        });
      },
      &quot;get the cookie&quot;: function(t) {
        assert.lengthOf(t.cookies, 2);
        assert.equal(t.cookies[0].key, &#039;broken_path&#039;);
        assert.equal(t.cookies[0].value, &#039;testme&#039;);
        assert.equal(t.cookies[1].key, &quot;b&quot;);
        assert.equal(t.cookies[1].value, &quot;2&quot;);
        assert.equal(t.cookies[1].path, &quot;/&quot;);
      },
    },
  }
})
.addBatch({
  &quot;Constructor&quot;:{
    topic: function () {
      return new Cookie({
        key: &#039;test&#039;,
        value: &#039;b&#039;,
        maxAge: 60
      });
    },
    &#039;check for key property&#039;: function (c) {
      assert.ok(c);
      assert.equal(c.key, &#039;test&#039;);
    },
    &#039;check for value property&#039;: function (c) {
      assert.equal(c.value, &#039;b&#039;);
    },
    &#039;check for maxAge&#039;: function (c) {
      assert.equal(c.maxAge, 60);
    },
    &#039;check for default values for unspecified properties&#039;: function (c) {
      assert.equal(c.expires, &quot;Infinity&quot;);
      assert.equal(c.secure, false);
      assert.equal(c.httpOnly, false);
    }
  }
})
.addBatch({
  &quot;allPaths option&quot;: {
    topic: function() {
      var cj = new CookieJar();
      var tasks = [];
      tasks.push(cj.setCookie.bind(cj, &#039;nopath_dom=qq; Path=/; Domain=example.com&#039;, &#039;http://example.com&#039;, {}));
      tasks.push(cj.setCookie.bind(cj, &#039;path_dom=qq; Path=/foo; Domain=example.com&#039;, &#039;http://example.com&#039;, {}));
      tasks.push(cj.setCookie.bind(cj, &#039;nopath_host=qq; Path=/&#039;, &#039;http://www.example.com&#039;, {}));
      tasks.push(cj.setCookie.bind(cj, &#039;path_host=qq; Path=/foo&#039;, &#039;http://www.example.com&#039;, {}));
      tasks.push(cj.setCookie.bind(cj, &#039;other=qq; Path=/&#039;, &#039;http://other.example.com/&#039;, {}));
      tasks.push(cj.setCookie.bind(cj, &#039;other2=qq; Path=/foo&#039;, &#039;http://other.example.com/foo&#039;, {}));
      var cb = this.callback;
      async.parallel(tasks, function(err,results) {
        cb(err, {cj:cj, cookies: results});
      });
    },
    &quot;all set&quot;: function(t) {
      assert.equal(t.cookies.length, 6);
      assert.ok(t.cookies.every(function(c) { return !!c }));
    },
    &quot;getting without allPaths&quot;: {
      topic: function(t) {
        var cb = this.callback;
        var cj = t.cj;
        cj.getCookies(&#039;http://www.example.com/&#039;, {}, function(err,cookies) {
          cb(err, {cj:cj, cookies:cookies});
        });
      },
      &quot;found just two cookies&quot;: function(t) {
        assert.equal(t.cookies.length, 2);
      },
      &quot;all are path=/&quot;: function(t) {
        assert.ok(t.cookies.every(function(c) { return c.path === &#039;/&#039; }));
      },
      &quot;no &#039;other&#039; cookies&quot;: function(t) {
        assert.ok(!t.cookies.some(function(c) { return (/^other/).test(c.name) }));
      },
    },
    &quot;getting without allPaths for /foo&quot;: {
      topic: function(t) {
        var cb = this.callback;
        var cj = t.cj;
        cj.getCookies(&#039;http://www.example.com/foo&#039;, {}, function(err,cookies) {
          cb(err, {cj:cj, cookies:cookies});
        });
      },
      &quot;found four cookies&quot;: function(t) {
        assert.equal(t.cookies.length, 4);
      },
      &quot;no &#039;other&#039; cookies&quot;: function(t) {
        assert.ok(!t.cookies.some(function(c) { return (/^other/).test(c.name) }));
      },
    },
    &quot;getting with allPaths:true&quot;: {
      topic: function(t) {
        var cb = this.callback;
        var cj = t.cj;
        cj.getCookies(&#039;http://www.example.com/&#039;, {allPaths:true}, function(err,cookies) {
          cb(err, {cj:cj, cookies:cookies});
        });
      },
      &quot;found four cookies&quot;: function(t) {
        assert.equal(t.cookies.length, 4);
      },
      &quot;no &#039;other&#039; cookies&quot;: function(t) {
        assert.ok(!t.cookies.some(function(c) { return (/^other/).test(c.name) }));
      },
    },
  }
})
.addBatch({
  &quot;remove cookies&quot;: {
    topic: function() {
      var jar = new CookieJar();
      var cookie = Cookie.parse(&quot;a=b; Domain=example.com; Path=/&quot;);
      var cookie2 = Cookie.parse(&quot;a=b; Domain=foo.com; Path=/&quot;);
      var cookie3 = Cookie.parse(&quot;foo=bar; Domain=foo.com; Path=/&quot;);
      jar.setCookie(cookie, &#039;http://example.com/index.html&#039;, function(){});
      jar.setCookie(cookie2, &#039;http://foo.com/index.html&#039;, function(){});
      jar.setCookie(cookie3, &#039;http://foo.com/index.html&#039;, function(){});
      return jar;
    },
    &quot;all from matching domain&quot;: function(jar){
      jar.store.removeCookies(&#039;example.com&#039;,null, function(err) {
        assert(err == null);

        jar.store.findCookies(&#039;example.com&#039;, null, function(err, cookies){
          assert(err == null);
          assert(cookies != null);
          assert(cookies.length === 0, &#039;cookie was not removed&#039;);
        });

        jar.store.findCookies(&#039;foo.com&#039;, null, function(err, cookies){
          assert(err == null);
          assert(cookies != null);
          assert(cookies.length === 2, &#039;cookies should not have been removed&#039;);
        });
      });
    },
    &quot;from cookie store matching domain and key&quot;: function(jar){
      jar.store.removeCookie(&#039;foo.com&#039;, &#039;/&#039;, &#039;foo&#039;, function(err) {
        assert(err == null);

        jar.store.findCookies(&#039;foo.com&#039;, null, function(err, cookies){
          assert(err == null);
          assert(cookies != null);
          assert(cookies.length === 1, &#039;cookie was not removed correctly&#039;);
          assert(cookies[0].key === &#039;a&#039;, &#039;wrong cookie was removed&#039;);
        });
      });
    }
  }
})
.addBatch({
  &quot;Synchronous CookieJar&quot;: {
    &quot;setCookieSync&quot;: {
      topic: function() {
        var jar = new CookieJar();
        var cookie = Cookie.parse(&quot;a=b; Domain=example.com; Path=/&quot;);
        cookie = jar.setCookieSync(cookie, &#039;http://example.com/index.html&#039;);
        return cookie;
      },
      &quot;returns a copy of the cookie&quot;: function(cookie) {
        assert.instanceOf(cookie, Cookie);
      }
    },

    &quot;setCookieSync strict parse error&quot;: {
      topic: function() {
        var jar = new CookieJar();
        var opts = { strict: true };
        try {
          jar.setCookieSync(&quot;farbe=weiß&quot;, &#039;http://example.com/index.html&#039;, opts);
          return false;
        } catch (e) {
          return e;
        }
      },
      &quot;throws the error&quot;: function(err) {
        assert.instanceOf(err, Error);
        assert.equal(err.message, &quot;Cookie failed to parse&quot;);
      }
    },

    &quot;getCookiesSync&quot;: {
      topic: function() {
        var jar = new CookieJar();
        var url = &#039;http://example.com/index.html&#039;;
        jar.setCookieSync(&quot;a=b; Domain=example.com; Path=/&quot;, url);
        jar.setCookieSync(&quot;c=d; Domain=example.com; Path=/&quot;, url);
        return jar.getCookiesSync(url);
      },
      &quot;returns the cookie array&quot;: function(err, cookies) {
        assert.ok(!err);
        assert.ok(Array.isArray(cookies));
        assert.lengthOf(cookies, 2);
        cookies.forEach(function(cookie) {
          assert.instanceOf(cookie, Cookie);
        });
      }
    },

    &quot;getCookieStringSync&quot;: {
      topic: function() {
        var jar = new CookieJar();
        var url = &#039;http://example.com/index.html&#039;;
        jar.setCookieSync(&quot;a=b; Domain=example.com; Path=/&quot;, url);
        jar.setCookieSync(&quot;c=d; Domain=example.com; Path=/&quot;, url);
        return jar.getCookieStringSync(url);
      },
      &quot;returns the cookie header string&quot;: function(err, str) {
        assert.ok(!err);
        assert.typeOf(str, &#039;string&#039;);
      }
    },

    &quot;getSetCookieStringsSync&quot;: {
      topic: function() {
        var jar = new CookieJar();
        var url = &#039;http://example.com/index.html&#039;;
        jar.setCookieSync(&quot;a=b; Domain=example.com; Path=/&quot;, url);
        jar.setCookieSync(&quot;c=d; Domain=example.com; Path=/&quot;, url);
        return jar.getSetCookieStringsSync(url);
      },
      &quot;returns the cookie header string&quot;: function(err, headers) {
        assert.ok(!err);
        assert.ok(Array.isArray(headers));
        assert.lengthOf(headers, 2);
        headers.forEach(function(header) {
          assert.typeOf(header, &#039;string&#039;);
        });
      }
    },
  }
})
.addBatch({
  &quot;Synchronous API on async CookieJar&quot;: {
    topic: function() {
      return new tough.Store();
    },
    &quot;setCookieSync&quot;: {
      topic: function(store) {
        var jar = new CookieJar(store);
        try {
          jar.setCookieSync(&quot;a=b&quot;, &#039;http://example.com/index.html&#039;);
          return false;
        } catch(e) {
          return e;
        }
      },
      &quot;fails&quot;: function(err) {
        assert.instanceOf(err, Error);
        assert.equal(err.message,
                     &#039;CookieJar store is not synchronous; use async API instead.&#039;);
      }
    },
    &quot;getCookiesSync&quot;: {
      topic: function(store) {
        var jar = new CookieJar(store);
        try {
          jar.getCookiesSync(&#039;http://example.com/index.html&#039;);
          return false;
        } catch(e) {
          return e;
        }
      },
      &quot;fails&quot;: function(err) {
        assert.instanceOf(err, Error);
        assert.equal(err.message,
                     &#039;CookieJar store is not synchronous; use async API instead.&#039;);
      }
    },
    &quot;getCookieStringSync&quot;: {
      topic: function(store) {
        var jar = new CookieJar(store);
        try {
          jar.getCookieStringSync(&#039;http://example.com/index.html&#039;);
          return false;
        } catch(e) {
          return e;
        }
      },
      &quot;fails&quot;: function(err) {
        assert.instanceOf(err, Error);
        assert.equal(err.message,
                     &#039;CookieJar store is not synchronous; use async API instead.&#039;);
      }
    },
    &quot;getSetCookieStringsSync&quot;: {
      topic: function(store) {
        var jar = new CookieJar(store);
        try {
          jar.getSetCookieStringsSync(&#039;http://example.com/index.html&#039;);
          return false;
        } catch(e) {
          return e;
        }
      },
      &quot;fails&quot;: function(err) {
        assert.instanceOf(err, Error);
        assert.equal(err.message,
                     &#039;CookieJar store is not synchronous; use async API instead.&#039;);
      }
    },
  }
})
.export(module);</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
