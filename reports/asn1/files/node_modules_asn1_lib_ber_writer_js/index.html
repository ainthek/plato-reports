<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/asn1/lib/ber/writer.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/asn1/lib/ber/writer.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">62.64</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">314</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">99.98</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.54</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// Copyright 2011 Mark Cavage &lt;mcavage@gmail.com&gt; All rights reserved.

var assert = require(&#039;assert&#039;);
var ASN1 = require(&#039;./types&#039;);
var errors = require(&#039;./errors&#039;);


///--- Globals

var newInvalidAsn1Error = errors.newInvalidAsn1Error;

var DEFAULT_OPTS = {
  size: 1024,
  growthFactor: 8
};


///--- Helpers

function merge(from, to) {
  assert.ok(from);
  assert.equal(typeof(from), &#039;object&#039;);
  assert.ok(to);
  assert.equal(typeof(to), &#039;object&#039;);

  var keys = Object.getOwnPropertyNames(from);
  keys.forEach(function(key) {
    if (to[key])
      return;

    var value = Object.getOwnPropertyDescriptor(from, key);
    Object.defineProperty(to, key, value);
  });

  return to;
}



///--- API

function Writer(options) {
  options = merge(DEFAULT_OPTS, options || {});

  this._buf = new Buffer(options.size || 1024);
  this._size = this._buf.length;
  this._offset = 0;
  this._options = options;

  // A list of offsets in the buffer where we need to insert
  // sequence tag/len pairs.
  this._seq = [];

  var self = this;
  this.__defineGetter__(&#039;buffer&#039;, function() {
    if (self._seq.length)
      throw new InvalidAsn1Error(self._seq.length + &#039; unended sequence(s)&#039;);

    return self._buf.slice(0, self._offset);
  });
}


Writer.prototype.writeByte = function(b) {
  if (typeof(b) !== &#039;number&#039;)
    throw new TypeError(&#039;argument must be a Number&#039;);

  this._ensure(1);
  this._buf[this._offset++] = b;
};


Writer.prototype.writeInt = function(i, tag) {
  if (typeof(i) !== &#039;number&#039;)
    throw new TypeError(&#039;argument must be a Number&#039;);
  if (typeof(tag) !== &#039;number&#039;)
    tag = ASN1.Integer;

  var sz = 4;

  while ((((i &amp; 0xff800000) === 0) || ((i &amp; 0xff800000) === 0xff800000 &gt;&gt; 0)) &amp;&amp;
         (sz &gt; 1)) {
    sz--;
    i &lt;&lt;= 8;
  }

  if (sz &gt; 4)
    throw new InvalidAsn1Error(&#039;BER ints cannot be &gt; 0xffffffff&#039;);

  this._ensure(2 + sz);
  this._buf[this._offset++] = tag;
  this._buf[this._offset++] = sz;

  while (sz-- &gt; 0) {
    this._buf[this._offset++] = ((i &amp; 0xff000000) &gt;&gt;&gt; 24);
    i &lt;&lt;= 8;
  }

};


Writer.prototype.writeNull = function() {
  this.writeByte(ASN1.Null);
  this.writeByte(0x00);
};


Writer.prototype.writeEnumeration = function(i, tag) {
  if (typeof(i) !== &#039;number&#039;)
    throw new TypeError(&#039;argument must be a Number&#039;);
  if (typeof(tag) !== &#039;number&#039;)
    tag = ASN1.Enumeration;

  return this.writeInt(i, tag);
};


Writer.prototype.writeBoolean = function(b, tag) {
  if (typeof(b) !== &#039;boolean&#039;)
    throw new TypeError(&#039;argument must be a Boolean&#039;);
  if (typeof(tag) !== &#039;number&#039;)
    tag = ASN1.Boolean;

  this._ensure(3);
  this._buf[this._offset++] = tag;
  this._buf[this._offset++] = 0x01;
  this._buf[this._offset++] = b ? 0xff : 0x00;
};


Writer.prototype.writeString = function(s, tag) {
  if (typeof(s) !== &#039;string&#039;)
    throw new TypeError(&#039;argument must be a string (was: &#039; + typeof(s) + &#039;)&#039;);
  if (typeof(tag) !== &#039;number&#039;)
    tag = ASN1.OctetString;

  var len = Buffer.byteLength(s);
  this.writeByte(tag);
  this.writeLength(len);
  if (len) {
    this._ensure(len);
    this._buf.write(s, this._offset);
    this._offset += len;
  }
};


Writer.prototype.writeBuffer = function(buf, tag) {
  if (typeof(tag) !== &#039;number&#039;)
    throw new TypeError(&#039;tag must be a number&#039;);
  if (!Buffer.isBuffer(buf))
    throw new TypeError(&#039;argument must be a buffer&#039;);

  this.writeByte(tag);
  this.writeLength(buf.length);
  this._ensure(buf.length);
  buf.copy(this._buf, this._offset, 0, buf.length);
  this._offset += buf.length;
};


Writer.prototype.writeStringArray = function(strings) {
  if ((!strings instanceof Array))
    throw new TypeError(&#039;argument must be an Array[String]&#039;);

  var self = this;
  strings.forEach(function(s) {
    self.writeString(s);
  });
};

// This is really to solve DER cases, but whatever for now
Writer.prototype.writeOID = function(s, tag) {
  if (typeof(s) !== &#039;string&#039;)
    throw new TypeError(&#039;argument must be a string&#039;);
  if (typeof(tag) !== &#039;number&#039;)
    tag = ASN1.OID;

  if (!/^([0-9]+\.){3,}[0-9]+$/.test(s))
    throw new Error(&#039;argument is not a valid OID string&#039;);

  function encodeOctet(bytes, octet) {
    if (octet &lt; 128) {
        bytes.push(octet);
    } else if (octet &lt; 16384) {
        bytes.push((octet &gt;&gt;&gt; 7) | 0x80);
        bytes.push(octet &amp; 0x7F);
    } else if (octet &lt; 2097152) {
      bytes.push((octet &gt;&gt;&gt; 14) | 0x80);
      bytes.push(((octet &gt;&gt;&gt; 7) | 0x80) &amp; 0xFF);
      bytes.push(octet &amp; 0x7F);
    } else if (octet &lt; 268435456) {
      bytes.push((octet &gt;&gt;&gt; 21) | 0x80);
      bytes.push(((octet &gt;&gt;&gt; 14) | 0x80) &amp; 0xFF);
      bytes.push(((octet &gt;&gt;&gt; 7) | 0x80) &amp; 0xFF);
      bytes.push(octet &amp; 0x7F);
    } else {
      bytes.push(((octet &gt;&gt;&gt; 28) | 0x80) &amp; 0xFF);
      bytes.push(((octet &gt;&gt;&gt; 21) | 0x80) &amp; 0xFF);
      bytes.push(((octet &gt;&gt;&gt; 14) | 0x80) &amp; 0xFF);
      bytes.push(((octet &gt;&gt;&gt; 7) | 0x80) &amp; 0xFF);
      bytes.push(octet &amp; 0x7F);
    }
  }

  var tmp = s.split(&#039;.&#039;);
  var bytes = [];
  bytes.push(parseInt(tmp[0], 10) * 40 + parseInt(tmp[1], 10));
  tmp.slice(2).forEach(function(b) {
    encodeOctet(bytes, parseInt(b, 10));
  });

  var self = this;
  this._ensure(2 + bytes.length);
  this.writeByte(tag);
  this.writeLength(bytes.length);
  bytes.forEach(function(b) {
    self.writeByte(b);
  });
};


Writer.prototype.writeLength = function(len) {
  if (typeof(len) !== &#039;number&#039;)
    throw new TypeError(&#039;argument must be a Number&#039;);

  this._ensure(4);

  if (len &lt;= 0x7f) {
    this._buf[this._offset++] = len;
  } else if (len &lt;= 0xff) {
    this._buf[this._offset++] = 0x81;
    this._buf[this._offset++] = len;
  } else if (len &lt;= 0xffff) {
    this._buf[this._offset++] = 0x82;
    this._buf[this._offset++] = len &gt;&gt; 8;
    this._buf[this._offset++] = len;
  } else if (len &lt;= 0xffffff) {
    this._buf[this._offset++] = 0x83;
    this._buf[this._offset++] = len &gt;&gt; 16;
    this._buf[this._offset++] = len &gt;&gt; 8;
    this._buf[this._offset++] = len;
  } else {
    throw new InvalidAsn1ERror(&#039;Length too long (&gt; 4 bytes)&#039;);
  }
};

Writer.prototype.startSequence = function(tag) {
  if (typeof(tag) !== &#039;number&#039;)
    tag = ASN1.Sequence | ASN1.Constructor;

  this.writeByte(tag);
  this._seq.push(this._offset);
  this._ensure(3);
  this._offset += 3;
};


Writer.prototype.endSequence = function() {
  var seq = this._seq.pop();
  var start = seq + 3;
  var len = this._offset - start;

  if (len &lt;= 0x7f) {
    this._shift(start, len, -2);
    this._buf[seq] = len;
  } else if (len &lt;= 0xff) {
    this._shift(start, len, -1);
    this._buf[seq] = 0x81;
    this._buf[seq + 1] = len;
  } else if (len &lt;= 0xffff) {
    this._buf[seq] = 0x82;
    this._buf[seq + 1] = len &gt;&gt; 8;
    this._buf[seq + 2] = len;
  } else if (len &lt;= 0xffffff) {
    this._shift(start, len, 1);
    this._buf[seq] = 0x83;
    this._buf[seq + 1] = len &gt;&gt; 16;
    this._buf[seq + 2] = len &gt;&gt; 8;
    this._buf[seq + 3] = len;
  } else {
    throw new InvalidAsn1Error(&#039;Sequence too long&#039;);
  }
};


Writer.prototype._shift = function(start, len, shift) {
  assert.ok(start !== undefined);
  assert.ok(len !== undefined);
  assert.ok(shift);

  this._buf.copy(this._buf, start + shift, start, start + len);
  this._offset += shift;
};

Writer.prototype._ensure = function(len) {
  assert.ok(len);

  if (this._size - this._offset &lt; len) {
    var sz = this._size * this._options.growthFactor;
    if (sz - this._offset &lt; len)
      sz += len;

    var buf = new Buffer(sz);

    this._buf.copy(buf, 0, 0, this._offset);
    this._buf = buf;
    this._size = sz;
  }
};



///--- Exported API

module.exports = Writer;</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
