<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/asn1/tst/ber/writer.test.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/asn1/tst/ber/writer.test.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">60.02</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">368</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">62.12</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">4.50</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// Copyright 2011 Mark Cavage &lt;mcavage@gmail.com&gt; All rights reserved.

var test = require(&#039;tap&#039;).test;
var sys = require(&#039;sys&#039;);

///--- Globals

var BerWriter;

var BerReader;


///--- Tests

test(&#039;load library&#039;, function(t) {
  BerWriter = require(&#039;../../lib/index&#039;).BerWriter;
  t.ok(BerWriter);
  t.ok(new BerWriter());
  t.end();
});


test(&#039;write byte&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeByte(0xC2);
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 1, &#039;Wrong length&#039;);
  t.equal(ber[0], 0xC2, &#039;value wrong&#039;);

  t.end();
});


test(&#039;write 1 byte int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(0x7f);
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 3, &#039;Wrong length for an int: &#039; + ber.length);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong (2) -&gt; &#039; + ber[0]);
  t.equal(ber[1], 0x01, &#039;length wrong(1) -&gt; &#039; + ber[1]);
  t.equal(ber[2], 0x7f, &#039;value wrong(3) -&gt; &#039; + ber[2]);

  t.end();
});


test(&#039;write 2 byte int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(0x7ffe);
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 4, &#039;Wrong length for an int&#039;);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong&#039;);
  t.equal(ber[1], 0x02, &#039;length wrong&#039;);
  t.equal(ber[2], 0x7f, &#039;value wrong (byte 1)&#039;);
  t.equal(ber[3], 0xfe, &#039;value wrong (byte 2)&#039;);

  t.end();
});


test(&#039;write 3 byte int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(0x7ffffe);
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 5, &#039;Wrong length for an int&#039;);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong&#039;);
  t.equal(ber[1], 0x03, &#039;length wrong&#039;);
  t.equal(ber[2], 0x7f, &#039;value wrong (byte 1)&#039;);
  t.equal(ber[3], 0xff, &#039;value wrong (byte 2)&#039;);
  t.equal(ber[4], 0xfe, &#039;value wrong (byte 3)&#039;);

  t.end();
});


test(&#039;write 4 byte int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(0x7ffffffe);
  var ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, 6, &#039;Wrong length for an int&#039;);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong&#039;);
  t.equal(ber[1], 0x04, &#039;length wrong&#039;);
  t.equal(ber[2], 0x7f, &#039;value wrong (byte 1)&#039;);
  t.equal(ber[3], 0xff, &#039;value wrong (byte 2)&#039;);
  t.equal(ber[4], 0xff, &#039;value wrong (byte 3)&#039;);
  t.equal(ber[5], 0xfe, &#039;value wrong (byte 4)&#039;);

  t.end();
});


test(&#039;write 1 byte negative int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(-128);
  var ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, 3, &#039;Wrong length for an int&#039;);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong&#039;);
  t.equal(ber[1], 0x01, &#039;length wrong&#039;);
  t.equal(ber[2], 0x80, &#039;value wrong (byte 1)&#039;);

  t.end();
});


test(&#039;write 2 byte negative int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(-22400);
  var ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, 4, &#039;Wrong length for an int&#039;);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong&#039;);
  t.equal(ber[1], 0x02, &#039;length wrong&#039;);
  t.equal(ber[2], 0xa8, &#039;value wrong (byte 1)&#039;);
  t.equal(ber[3], 0x80, &#039;value wrong (byte 2)&#039;);

  t.end();
});


test(&#039;write 3 byte negative int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(-481653);
  var ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, 5, &#039;Wrong length for an int&#039;);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong&#039;);
  t.equal(ber[1], 0x03, &#039;length wrong&#039;);
  t.equal(ber[2], 0xf8, &#039;value wrong (byte 1)&#039;);
  t.equal(ber[3], 0xa6, &#039;value wrong (byte 2)&#039;);
  t.equal(ber[4], 0x8b, &#039;value wrong (byte 3)&#039;);

  t.end();
});


test(&#039;write 4 byte negative int&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeInt(-1522904131);
  var ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, 6, &#039;Wrong length for an int&#039;);
  t.equal(ber[0], 0x02, &#039;ASN.1 tag wrong&#039;);
  t.equal(ber[1], 0x04, &#039;length wrong&#039;);
  t.equal(ber[2], 0xa5, &#039;value wrong (byte 1)&#039;);
  t.equal(ber[3], 0x3a, &#039;value wrong (byte 2)&#039;);
  t.equal(ber[4], 0x53, &#039;value wrong (byte 3)&#039;);
  t.equal(ber[5], 0xbd, &#039;value wrong (byte 4)&#039;);

  t.end();
});


test(&#039;write boolean&#039;, function(t) {
  var writer = new BerWriter();

  writer.writeBoolean(true);
  writer.writeBoolean(false);
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 6, &#039;Wrong length&#039;);
  t.equal(ber[0], 0x01, &#039;tag wrong&#039;);
  t.equal(ber[1], 0x01, &#039;length wrong&#039;);
  t.equal(ber[2], 0xff, &#039;value wrong&#039;);
  t.equal(ber[3], 0x01, &#039;tag wrong&#039;);
  t.equal(ber[4], 0x01, &#039;length wrong&#039;);
  t.equal(ber[5], 0x00, &#039;value wrong&#039;);

  t.end();
});


test(&#039;write string&#039;, function(t) {
  var writer = new BerWriter();
  writer.writeString(&#039;hello world&#039;);
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 13, &#039;wrong length&#039;);
  t.equal(ber[0], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[1], 11, &#039;wrong length&#039;);
  t.equal(ber.slice(2).toString(&#039;utf8&#039;), &#039;hello world&#039;, &#039;wrong value&#039;);

  t.end();
});

test(&#039;write buffer&#039;, function(t) {
  var writer = new BerWriter();
  // write some stuff to start with
  writer.writeString(&#039;hello world&#039;);
  var ber = writer.buffer;
  var buf = new Buffer([0x04, 0x0b, 0x30, 0x09, 0x02, 0x01, 0x0f, 0x01, 0x01,
     0xff, 0x01, 0x01, 0xff]);
  writer.writeBuffer(buf.slice(2, buf.length), 0x04);
  ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 26, &#039;wrong length&#039;);
  t.equal(ber[0], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[1], 11, &#039;wrong length&#039;);
  t.equal(ber.slice(2, 13).toString(&#039;utf8&#039;), &#039;hello world&#039;, &#039;wrong value&#039;);
  t.equal(ber[13], buf[0], &#039;wrong tag&#039;);
  t.equal(ber[14], buf[1], &#039;wrong length&#039;);
  for (var i = 13, j = 0; i &lt; ber.length &amp;&amp; j &lt; buf.length; i++, j++) {
    t.equal(ber[i], buf[j], &#039;buffer contents not identical&#039;);
  }
  t.end();
});

test(&#039;write string array&#039;, function(t) {
  var writer = new BerWriter();
  writer.writeStringArray([&#039;hello world&#039;, &#039;fubar!&#039;]);
  var ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, 21, &#039;wrong length&#039;);
  t.equal(ber[0], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[1], 11, &#039;wrong length&#039;);
  t.equal(ber.slice(2, 13).toString(&#039;utf8&#039;), &#039;hello world&#039;, &#039;wrong value&#039;);

  t.equal(ber[13], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[14], 6, &#039;wrong length&#039;);
  t.equal(ber.slice(15).toString(&#039;utf8&#039;), &#039;fubar!&#039;, &#039;wrong value&#039;);

  t.end();
});


test(&#039;resize internal buffer&#039;, function(t) {
  var writer = new BerWriter({size: 2});
  writer.writeString(&#039;hello world&#039;);
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 13, &#039;wrong length&#039;);
  t.equal(ber[0], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[1], 11, &#039;wrong length&#039;);
  t.equal(ber.slice(2).toString(&#039;utf8&#039;), &#039;hello world&#039;, &#039;wrong value&#039;);

  t.end();
});


test(&#039;sequence&#039;, function(t) {
  var writer = new BerWriter({size: 25});
  writer.startSequence();
  writer.writeString(&#039;hello world&#039;);
  writer.endSequence();
  var ber = writer.buffer;

  t.ok(ber);
  console.log(ber);
  t.equal(ber.length, 15, &#039;wrong length&#039;);
  t.equal(ber[0], 0x30, &#039;wrong tag&#039;);
  t.equal(ber[1], 13, &#039;wrong length&#039;);
  t.equal(ber[2], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[3], 11, &#039;wrong length&#039;);
  t.equal(ber.slice(4).toString(&#039;utf8&#039;), &#039;hello world&#039;, &#039;wrong value&#039;);

  t.end();
});


test(&#039;nested sequence&#039;, function(t) {
  var writer = new BerWriter({size: 25});
  writer.startSequence();
  writer.writeString(&#039;hello world&#039;);
  writer.startSequence();
  writer.writeString(&#039;hello world&#039;);
  writer.endSequence();
  writer.endSequence();
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 30, &#039;wrong length&#039;);
  t.equal(ber[0], 0x30, &#039;wrong tag&#039;);
  t.equal(ber[1], 28, &#039;wrong length&#039;);
  t.equal(ber[2], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[3], 11, &#039;wrong length&#039;);
  t.equal(ber.slice(4, 15).toString(&#039;utf8&#039;), &#039;hello world&#039;, &#039;wrong value&#039;);
  t.equal(ber[15], 0x30, &#039;wrong tag&#039;);
  t.equal(ber[16], 13, &#039;wrong length&#039;);
  t.equal(ber[17], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[18], 11, &#039;wrong length&#039;);
  t.equal(ber.slice(19, 30).toString(&#039;utf8&#039;), &#039;hello world&#039;, &#039;wrong value&#039;);

  t.end();
});


test(&#039;LDAP bind message&#039;, function(t) {
  var dn = &#039;cn=foo,ou=unit,o=test&#039;;
  var writer = new BerWriter();
  writer.startSequence();
  writer.writeInt(3);             // msgid = 3
  writer.startSequence(0x60);     // ldap bind
  writer.writeInt(3);             // ldap v3
  writer.writeString(dn);
  writer.writeByte(0x80);
  writer.writeByte(0x00);
  writer.endSequence();
  writer.endSequence();
  var ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, 35, &#039;wrong length (buffer)&#039;);
  t.equal(ber[0], 0x30, &#039;wrong tag&#039;);
  t.equal(ber[1], 33, &#039;wrong length&#039;);
  t.equal(ber[2], 0x02, &#039;wrong tag&#039;);
  t.equal(ber[3], 1, &#039;wrong length&#039;);
  t.equal(ber[4], 0x03, &#039;wrong value&#039;);
  t.equal(ber[5], 0x60, &#039;wrong tag&#039;);
  t.equal(ber[6], 28, &#039;wrong length&#039;);
  t.equal(ber[7], 0x02, &#039;wrong tag&#039;);
  t.equal(ber[8], 1, &#039;wrong length&#039;);
  t.equal(ber[9], 0x03, &#039;wrong value&#039;);
  t.equal(ber[10], 0x04, &#039;wrong tag&#039;);
  t.equal(ber[11], dn.length, &#039;wrong length&#039;);
  t.equal(ber.slice(12, 33).toString(&#039;utf8&#039;), dn, &#039;wrong value&#039;);
  t.equal(ber[33], 0x80, &#039;wrong tag&#039;);
  t.equal(ber[34], 0x00, &#039;wrong len&#039;);

  t.end();
});


test(&#039;Write OID&#039;, function(t) {
  var oid = &#039;1.2.840.113549.1.1.1&#039;;
  var writer = new BerWriter();
  writer.writeOID(oid);

  var ber = writer.buffer;
  t.ok(ber);
  console.log(require(&#039;util&#039;).inspect(ber));
  console.log(require(&#039;util&#039;).inspect(new Buffer([0x06, 0x09, 0x2a, 0x86,
                                                  0x48, 0x86, 0xf7, 0x0d,
                                                  0x01, 0x01, 0x01])));

  t.end();
});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
